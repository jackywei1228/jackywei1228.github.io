<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    
    <title>system_server内存泄漏 | 彪彪</title>
    
    
        <meta name="keywords" content="system_server内存泄漏">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="卡顿原因:用android Device Monitor 获取的文件中:ddms8967132311110557686.trace windowContainer.ForAllWindows 超过2.7秒 抓取 hprof文件分析:找到和ForAllWindows函数相关的对象: adb shell ps | grep -i system_server ps = 923 adb shell am">
<meta property="og:type" content="article">
<meta property="og:title" content="system_server内存泄漏">
<meta property="og:url" content="https://ifonly.me/2018/12/13/bug-jie-xi/system-server-nei-cun-xie-lu/index.html">
<meta property="og:site_name" content="彪彪">
<meta property="og:description" content="卡顿原因:用android Device Monitor 获取的文件中:ddms8967132311110557686.trace windowContainer.ForAllWindows 超过2.7秒 抓取 hprof文件分析:找到和ForAllWindows函数相关的对象: adb shell ps | grep -i system_server ps = 923 adb shell am">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-12-13T07:52:54.021Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="system_server内存泄漏">
<meta name="twitter:description" content="卡顿原因:用android Device Monitor 获取的文件中:ddms8967132311110557686.trace windowContainer.ForAllWindows 超过2.7秒 抓取 hprof文件分析:找到和ForAllWindows函数相关的对象: adb shell ps | grep -i system_server ps = 923 adb shell am">
    

    
        <link rel="alternate" href="/atom.xml" title="彪彪" type="application/atom+xml">
    

    
        <link rel="icon" href="/favicon.ico">
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">
    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/libs/jquery/plugins/cookie/1.4.1/jquery.cookie.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
</head>
</html>
<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">彪彪</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">首页</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/categories">分类</a>
                
                    <a class="main-nav-link" href="/tags">标签</a>
                
                    <a class="main-nav-link" href="/about">关于</a>
                
            </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">首页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/categories">分类</a></td>
                
                    <td><a class="main-nav-link" href="/tags">标签</a></td>
                
                    <td><a class="main-nav-link" href="/about">关于</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索">
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap" id="categories">
        <h3 class="widget-title">
            <span>分类</span>
            &nbsp;
            <a id="allExpand" href="#">
                <i class="fa fa-angle-double-down fa-2x"></i>
            </a>
        </h3>
        
        
        
         <ul class="unstyled" id="tree"> 
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            BUG解析
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/2018/12/13/bug-jie-xi/diag-kou-man-de-wen-ti/">Diag 口慢的问题</a></li>  <li class="file"><a href="/2018/12/13/bug-jie-xi/shou-ji-fan-ying-ji-su-bian-man/">手机反应速度变慢</a></li>  <li class="file"><a href="/2018/12/13/bug-jie-xi/flash-yue-jie/">Flash越界</a></li>  <li class="file"><a href="/2018/12/13/bug-jie-xi/fota-sheng-ji-kai-bu-ji/">Fota升级之后无法开机</a></li>  <li class="file"><a href="/2018/12/13/bug-jie-xi/man-de-wen-ti-2/">慢的问题2</a></li>  <li class="file"><a href="/2018/12/13/bug-jie-xi/shan-ping-fen-xi/">闪屏分析</a></li>  <li class="file"><a href="/2018/12/13/bug-jie-xi/whatsapp-lai-dian-qi-dong-man-de-wen-ti/">Whatsapp 来电启动慢的问题</a></li>  <li class="file"><a href="/2018/12/13/bug-jie-xi/chang-shi-jian-shi-yong-zhi-hou-shou-ji-fan-ying-bian-man/">长时间使用之后手机变慢</a></li>  <li class="file active"><a href="/2018/12/13/bug-jie-xi/system-server-nei-cun-xie-lu/">system_server内存泄漏</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            React学习
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/2018/12/13/react-xue-xi/001-xue-xi-wang-zhi/">学习资料</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            工作小贴士
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/android-mat-gong-ju-shi-yong/">Android_Mat_工具使用</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/git-xia-zai-dai-li-she-zhi/">Git 下载代理设置</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/performance/">Performance</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/monkey-ce-shi-ming-ling-xing/">Monkey test command</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/ubuntuinstallshadowsocks/">ubuntu Shadowsocks 安装</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/vts-ce-shi-bu-zou/">VTS测试说明</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/binder-xin-xi/">binder 信息</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/gdb-diao-shi-shou-ce/">GDB调试手机工程</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/hello-world/">Hello World</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/memory-debug/">Memory debug</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/nodejscluster/">解读Nodejs多核处理模块cluster</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/nodejs-an-zhuang/">nodejs 安装</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/qcn-bei-fen/">qcn备份</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/shadowsock/">ubuntu Shadowsocks Error</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/trace32/">ubuntu trace32 安装</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/ubuntu-mysql-install/">ubuntu Mysql 安装</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/an-zhuang-vtiger/">Vtiger 安装</a></li>  <li class="file"><a href="/2018/12/14/gong-zuo-xiao-tie-shi/gong-zuo-bi-ji/">工作笔记</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/chang-yong-an-ma/">常用暗码</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/shou-ji-gua-duan-bu-liao-dian-hua/">多次拨打电话并且挂断之后.会在某一次拨号界面会冻住</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/pi-liang-shan-chu-dai-ma-zhong-de-zi-fu-chuan/">批量替换代码中的字符串</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/la-qi-suo-you-cpu/">把所有CPU拉到最高</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/ke-xue-shang-wang/">科学上网</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/flash-yue-jie/">Flash 越界</a></li>  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/hei-ping-fen-xi/">黑屏分析</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            杂记
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/2018/12/13/gong-zuo-xiao-tie-shi/apache2-xia-zai-fu-wu-qi-pei-zhi/">apache2 下载服务器配置</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            框架设计
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/2018/12/14/kuang-jia-she-ji/001-log-gong-ju-she-ji/">LOG工具设计</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            需求实现
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Fota功能的实现
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/2018/12/13/xu-qiu-shi-xian/fota-gong-neng-de-shi-xian/databasesinfo/">DatabasesInfo</a></li>  <li class="file"><a href="/2018/12/14/xu-qiu-shi-xian/fota-gong-neng-de-shi-xian/ye-wu-luo-ji-gui-hua/">业务逻辑规划</a></li>  <li class="file"><a href="/2018/12/13/xu-qiu-shi-xian/fota-gong-neng-de-shi-xian/bei-fen/">备份</a></li>  <li class="file"><a href="/2018/12/13/xu-qiu-shi-xian/fota-gong-neng-de-shi-xian/shu-ju-ku-biao-de-jian-li/">数据库表的建立</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                     </ul> 
    </div>
    <script>
        $(document).ready(function() {
            var iconFolderOpenClass  = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';
            var iconAllExpandClass = 'fa-angle-double-down';
            var iconAllPackClass = 'fa-angle-double-up';
            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({ duration: 100 });
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({ duration: 100 });
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });
            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function(event){
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if(expanded) {
                    subtrees.slideUp({ duration: 100 });
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({ duration: 100 });
                    icons.addClass(iconFolderOpenClass);
                }
            })
            // 展开关闭所有目录按钮
            $(document).on('click', '#allExpand', function (event) {
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconAllExpandClass);
                icon.removeClass(iconAllExpandClass).removeClass(iconAllPackClass);
                if(expanded) {
                    $('#sidebar .fa.fa-folder').removeClass('fa-folder').addClass('fa-folder-open')
                    $('#categories li ul').slideDown({ duration: 100 });
                    icon.addClass(iconAllPackClass);
                } else {
                    $('#sidebar .fa.fa-folder-open').removeClass('fa-folder-open').addClass('fa-folder')
                    $('#categories li ul').slideUp({ duration: 100 });
                    icon.addClass(iconAllExpandClass);
                }
            });  
        });
    </script>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
            <section id="main"><article id="post-BUG解析/system_server内存泄露" class="article article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/BUG解析/">BUG解析</a>
    </div>

                        
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/12/13/bug-jie-xi/system-server-nei-cun-xie-lu/">
            <time datetime="2018-12-13T07:53:54.437Z" itemprop="datePublished">2018-12-13</time>
        </a>
    </div>


                        
                            <i class="fa fa-bar-chart"></i>
                            <span id="busuanzi_container_site_pv"><span id="busuanzi_value_page_pv"></span></span>    
                        
                        
                            <div class="article-meta-button">
                                <a href="https://github.com/zthxxx/Wiki-site/raw/writing/source/_posts/BUG解析/system_server内存泄露.md"> Source </a>
                            </div>
                            <div class="article-meta-button">
                                <a href="https://github.com/zthxxx/Wiki-site/edit/writing/source/_posts/BUG解析/system_server内存泄露.md"> Edit </a>
                            </div>
                            <div class="article-meta-button">
                                <a href="https://github.com/zthxxx/Wiki-site/commits/writing/source/_posts/BUG解析/system_server内存泄露.md"> History </a>
                            </div>
                        
                    </div>
                
                
    
        <h1 class="article-title" itemprop="name">
            system_server内存泄漏
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <h1 id="卡顿原因"><a href="#卡顿原因" class="headerlink" title="卡顿原因:"></a>卡顿原因:</h1><p>用android Device Monitor 获取的文件中:<br>ddms8967132311110557686.trace</p>
<p>windowContainer.ForAllWindows 超过2.7秒</p>
<p>抓取 hprof文件分析:<br>找到和ForAllWindows函数相关的对象:</p>
<p>adb shell ps | grep -i system_server</p>
<p>ps = 923</p>
<p>adb shell am dumpheap 923 /data/local/tmp/923.hprof</p>
<p>hprof-conv 923.hprof 923_mat.hprof</p>
<h2 id="Class-Name-Objects-Shallow-Heap-Retained-Heap"><a href="#Class-Name-Objects-Shallow-Heap-Retained-Heap" class="headerlink" title="Class Name                                                       | Objects | Shallow Heap | Retained Heap"></a>Class Name                                                       | Objects | Shallow Heap | Retained Heap</h2><p>com.android.server.wm.WindowState                                |     855 |      376,200 |  &gt;= 2,204,304<br>com.android.server.wm.WindowStateAnimator                        |     855 |      191,520 |    &gt;= 465,872<br>com.android.server.wm.WindowState$WindowId                       |     855 |       27,360 |     &gt;= 48,280<br>com.android.server.wm.WindowState$UpdateReportedVisibilityResults|     911 |       21,864 |     &gt;= 22,056</p>
<h2 id="com-android-server-wm-WindowState-DeathRecipient-855-13-680-gt-13-912"><a href="#com-android-server-wm-WindowState-DeathRecipient-855-13-680-gt-13-912" class="headerlink" title="com.android.server.wm.WindowState$DeathRecipient                 |     855 |       13,680 |     &gt;= 13,912"></a>com.android.server.wm.WindowState$DeathRecipient                 |     855 |       13,680 |     &gt;= 13,912</h2><h2 id="Class-Name-Objects-Shallow-Heap-Retained-Heap-1"><a href="#Class-Name-Objects-Shallow-Heap-Retained-Heap-1" class="headerlink" title="Class Name                                | Objects | Shallow Heap | Retained Heap"></a>Class Name                                | Objects | Shallow Heap | Retained Heap</h2><p>com.android.server.am.ActivityRecord      |     921 |      353,664 |  &gt;= 2,144,720</p>
<h2 id="com-android-server-am-ActivityRecord-Token-955-30-560-gt-53-848"><a href="#com-android-server-am-ActivityRecord-Token-955-30-560-gt-53-848" class="headerlink" title="com.android.server.am.ActivityRecord$Token|     955 |       30,560 |     &gt;= 53,848"></a>com.android.server.am.ActivityRecord$Token|     955 |       30,560 |     &gt;= 53,848</h2><h2 id="Type-Name-Value"><a href="#Type-Name-Value" class="headerlink" title="Type|Name    |Value"></a>Type|Name    |Value</h2><h2 id="ref-appToken-com-android-server-am-ActivityRecord-Token-0x16f12f88"><a href="#ref-appToken-com-android-server-am-ActivityRecord-Token-0x16f12f88" class="headerlink" title="ref |appToken|com.android.server.am.ActivityRecord$Token @ 0x16f12f88"></a>ref |appToken|com.android.server.am.ActivityRecord$Token @ 0x16f12f88</h2><h2 id="Type-Name-Value-1"><a href="#Type-Name-Value-1" class="headerlink" title="Type|Name    |Value"></a>Type|Name    |Value</h2><p>ref |appInfo |android.content.pm.ApplicationInfo @ 0x1542e100<br>ref |appToken|com.android.server.am.ActivityRecord$Token @ 0x16f12f88</p>
<h2 id="ref-compat-android-content-res-CompatibilityInfo-0x17065af0"><a href="#ref-compat-android-content-res-CompatibilityInfo-0x17065af0" class="headerlink" title="ref |compat  |android.content.res.CompatibilityInfo @ 0x17065af0"></a>ref |compat  |android.content.res.CompatibilityInfo @ 0x17065af0</h2><h2 id="Class-Name-Objects-Shallow-Heap-Retained-Heap-2"><a href="#Class-Name-Objects-Shallow-Heap-Retained-Heap-2" class="headerlink" title="Class Name                           | Objects | Shallow Heap | Retained Heap"></a>Class Name                           | Objects | Shallow Heap | Retained Heap</h2><h2 id="android-content-res-CompatibilityInfo-945-22-680-gt-22-952"><a href="#android-content-res-CompatibilityInfo-945-22-680-gt-22-952" class="headerlink" title="android.content.res.CompatibilityInfo|     945 |       22,680 |     &gt;= 22,952"></a>android.content.res.CompatibilityInfo|     945 |       22,680 |     &gt;= 22,952</h2><p>ActivityRecord 也有泄漏?????</p>
<p>PATH TO GC ROOT</p>
<h2 id="Class-Name-Shallow-Heap-Retained-Heap"><a href="#Class-Name-Shallow-Heap-Retained-Heap" class="headerlink" title="Class Name                                                                                  | Shallow Heap | Retained Heap"></a>Class Name                                                                                  | Shallow Heap | Retained Heap</h2><p>com.android.server.wm.WindowState @ 0x15826d18                                              |          440 |         3,664<br>‘- [0] com.android.server.wm.WindowState[20] @ 0x15825c10                                   |           96 |            96</p>
<h2 id="‘-mPendingRemoveTmp-com-android-server-wm-WindowManagerService-0x12cd2950-Native-Stack-512-5-064"><a href="#‘-mPendingRemoveTmp-com-android-server-wm-WindowManagerService-0x12cd2950-Native-Stack-512-5-064" class="headerlink" title="   ‘- mPendingRemoveTmp com.android.server.wm.WindowManagerService @ 0x12cd2950 Native Stack|          512 |         5,064"></a>   ‘- mPendingRemoveTmp com.android.server.wm.WindowManagerService @ 0x12cd2950 Native Stack|          512 |         5,064</h2><p>Merge GC ROOT:</p>
<h2 id="Class-Name-Ref-Objects-Shallow-Heap-Ref-Shallow-Heap-Retained-Heap"><a href="#Class-Name-Ref-Objects-Shallow-Heap-Ref-Shallow-Heap-Retained-Heap" class="headerlink" title="Class Name                                                             | Ref. Objects | Shallow Heap | Ref. Shallow Heap | Retained Heap"></a>Class Name                                                             | Ref. Objects | Shallow Heap | Ref. Shallow Heap | Retained Heap</h2><p>com.android.server.wm.WindowManagerService @ 0x12cd2950 Native Stack   |            1 |          512 |               440 |         5,064<br>‘- mPendingRemoveTmp com.android.server.wm.WindowState[20] @ 0x15825c10|            1 |           96 |               440 |            96</p>
<h2 id="‘-0-com-android-server-wm-WindowState-0x15826d18-1-440-440-3-664"><a href="#‘-0-com-android-server-wm-WindowState-0x15826d18-1-440-440-3-664" class="headerlink" title="   ‘- [0] com.android.server.wm.WindowState @ 0x15826d18               |            1 |          440 |               440 |         3,664"></a>   ‘- [0] com.android.server.wm.WindowState @ 0x15826d18               |            1 |          440 |               440 |         3,664</h2><p>+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br>PATH TO GC ROOT</p>
<h2 id="Class-Name-Shallow-Heap-Retained-Heap-1"><a href="#Class-Name-Shallow-Heap-Retained-Heap-1" class="headerlink" title="Class Name                                                                                                                        | Shallow Heap | Retained Heap"></a>Class Name                                                                                                                        | Shallow Heap | Retained Heap</h2><p>com.android.server.wm.WindowState @ 0x14be1080                                                                                    |          440 |         2,536<br>‘- mWin com.android.server.wm.WindowStateAnimator @ 0x14be0e78                                                                    |          224 |           544<br>   ‘- [0] java.lang.Object[10] @ 0x14be0e40                                                                                       |           56 |            56<br>      ‘- elementData java.util.ArrayList @ 0x14be0d98                                                                             |           24 |            80<br>         ‘- mAllAppWinAnimators com.android.server.wm.AppWindowAnimator @ 0x14be0b80                                              |           96 |           288<br>            ‘- mAppAnimator com.android.server.wm.AppWindowToken @ 0x14be0810                                                     |          200 |         1,272<br>               ‘- value java.util.HashMap$Node @ 0x12dbe658                                                                       |           24 |            24<br>                  ‘- [1511] java.util.HashMap$Node[2048] @ 0x12db91f8                                                             |        8,208 |        30,192<br>                     ‘- table java.util.HashMap @ 0x12db86a0                                                                      |           40 |        30,248<br>                        ‘- mTokenMap com.android.server.wm.DisplayContent @ 0x12db7bd0                                            |          312 |        58,344<br>                           |- mDisplayContent com.android.server.wm.AppWindowToken @ 0x14bc22d8                                   |          200 |         1,256<br>                           |  |- mFocusedApp com.android.server.wm.WindowManagerService @ 0x12cd2950 Native Stack                 |          512 |         5,064<br>                           |  |- mAppToken, mToken, mParent com.android.server.wm.WindowState @ 0x12db24d8                        |          440 |         3,064<br>                           |  |  |- mCurrentFocus, mLastFocus com.android.server.wm.WindowManagerService @ 0x12cd2950 Native Stack|          512 |         5,064<br>                           |  |  |- this$0 com.android.server.wm.WindowState$DeathRecipient @ 0x12d9d5d0 Native Stack             |           16 |            16<br>                           |  |  |- mInputFocus com.android.server.wm.InputMonitor @ 0x15501a98                                   |           56 |           728</p>
<pre><code>|  |  |  &apos;- mInputMonitor com.android.server.wm.WindowManagerService @ 0x12cd2950 Native Stack         |          512 |         5,064
</code></pre><hr>
<p>Merge GC ROOT:</p>
<h2 id="Class-Name-Ref-Objects-Shallow-Heap-Ref-Shallow-Heap-Retained-Heap-1"><a href="#Class-Name-Ref-Objects-Shallow-Heap-Ref-Shallow-Heap-Retained-Heap-1" class="headerlink" title="Class Name                                                                              | Ref. Objects | Shallow Heap | Ref. Shallow Heap | Retained Heap"></a>Class Name                                                                              | Ref. Objects | Shallow Heap | Ref. Shallow Heap | Retained Heap</h2><p>com.android.server.wm.WindowManagerService @ 0x12cd2950 Native Stack                    |            1 |          512 |               440 |         5,064<br>‘- mFocusedApp com.android.server.wm.AppWindowToken @ 0x14bc22d8                        |            1 |          200 |               440 |         1,256<br>   ‘- mDisplayContent com.android.server.wm.DisplayContent @ 0x12db7bd0                 |            1 |          312 |               440 |        58,344<br>      ‘- mTokenMap java.util.HashMap @ 0x12db86a0                                       |            1 |           40 |               440 |        30,248<br>         ‘- table java.util.HashMap$Node[2048] @ 0x12db91f8                             |            1 |        8,208 |               440 |        30,192<br>            ‘- [1511] java.util.HashMap$Node @ 0x12dbe658                               |            1 |           24 |               440 |            24<br>               ‘- value com.android.server.wm.AppWindowToken @ 0x14be0810               |            1 |          200 |               440 |         1,272<br>                  ‘- mAppAnimator com.android.server.wm.AppWindowAnimator @ 0x14be0b80  |            1 |           96 |               440 |           288<br>                     ‘- mAllAppWinAnimators java.util.ArrayList @ 0x14be0d98            |            1 |           24 |               440 |            80<br>                        ‘- elementData java.lang.Object[10] @ 0x14be0e40                |            1 |           56 |               440 |            56<br>                           ‘- [0] com.android.server.wm.WindowStateAnimator @ 0x14be0e78|            1 |          224 |               440 |           544</p>
<pre><code>&apos;- mWin com.android.server.wm.WindowState @ 0x14be1080    |            1 |          440 |               440 |         2,536
</code></pre><hr>
<p>对象实例:mAppAnimator com.android.server.wm.AppWindowAnimator @ 0x14be0b80<br>说明:<br>都是mDisplayContent的mTokenMap持有.没有释放.</p>
<h2 id="Class-Name-Ref-Objects-Shallow-Heap-Ref-Shallow-Heap-Retained-Heap-2"><a href="#Class-Name-Ref-Objects-Shallow-Heap-Ref-Shallow-Heap-Retained-Heap-2" class="headerlink" title="Class Name                                                                            | Ref. Objects | Shallow Heap | Ref. Shallow Heap | Retained Heap"></a>Class Name                                                                            | Ref. Objects | Shallow Heap | Ref. Shallow Heap | Retained Heap</h2><p>com.android.server.wm.WindowManagerService @ 0x12cd2950 Native Stack                  |            1 |          512 |                96 |         5,064<br>‘- mFocusedApp com.android.server.wm.AppWindowToken @ 0x14bc22d8                      |            1 |          200 |                96 |         1,256<br>   ‘- mDisplayContent com.android.server.wm.DisplayContent @ 0x12db7bd0               |            1 |          312 |                96 |        58,344<br>      ‘- mTokenMap java.util.HashMap @ 0x12db86a0                                     |            1 |           40 |                96 |        30,248<br>         ‘- table java.util.HashMap$Node[2048] @ 0x12db91f8                           |            1 |        8,208 |                96 |        30,192<br>            ‘- [1511] java.util.HashMap$Node @ 0x12dbe658                             |            1 |           24 |                96 |            24<br>               ‘- value com.android.server.wm.AppWindowToken @ 0x14be0810             |            1 |          200 |                96 |         1,272</p>
<pre><code>&apos;- mAppAnimator com.android.server.wm.AppWindowAnimator @ 0x14be0b80|            1 |           96 |                96 |           288
</code></pre><hr>
<h2 id="Class-Name-Ref-Objects-Shallow-Heap-Ref-Shallow-Heap-Retained-Heap-3"><a href="#Class-Name-Ref-Objects-Shallow-Heap-Ref-Shallow-Heap-Retained-Heap-3" class="headerlink" title="Class Name                                                                            | Ref. Objects | Shallow Heap | Ref. Shallow Heap | Retained Heap"></a>Class Name                                                                            | Ref. Objects | Shallow Heap | Ref. Shallow Heap | Retained Heap</h2><p>com.android.server.wm.WindowManagerService @ 0x12cd2950 Native Stack                  |            1 |          512 |                96 |         5,064<br>‘- mFocusedApp com.android.server.wm.AppWindowToken @ 0x14bc22d8                      |            1 |          200 |                96 |         1,256<br>   ‘- mDisplayContent com.android.server.wm.DisplayContent @ 0x12db7bd0               |            1 |          312 |                96 |        58,344<br>      ‘- mTokenMap java.util.HashMap @ 0x12db86a0                                     |            1 |           40 |                96 |        30,248<br>         ‘- table java.util.HashMap$Node[2048] @ 0x12db91f8                           |            1 |        8,208 |                96 |        30,192<br>            ‘- [792] java.util.HashMap$Node @ 0x12dbccc0                              |            1 |           24 |                96 |            48<br>               ‘- value com.android.server.wm.AppWindowToken @ 0x12ead060             |            1 |          200 |                96 |         1,296</p>
<pre><code>&apos;- mAppAnimator com.android.server.wm.AppWindowAnimator @ 0x12eada90|            1 |           96 |                96 |           288
</code></pre><hr>
<h2 id="Class-Name-Shallow-Heap-Retained-Heap-Percentage"><a href="#Class-Name-Shallow-Heap-Retained-Heap-Percentage" class="headerlink" title="Class Name                                          | Shallow Heap | Retained Heap | Percentage"></a>Class Name                                          | Shallow Heap | Retained Heap | Percentage</h2><h2 id="com-android-server-wm-AppWindowAnimator-0x14be0b80-96-288-0-00"><a href="#com-android-server-wm-AppWindowAnimator-0x14be0b80-96-288-0-00" class="headerlink" title="com.android.server.wm.AppWindowAnimator @ 0x14be0b80|           96 |           288 |      0.00%"></a>com.android.server.wm.AppWindowAnimator @ 0x14be0b80|           96 |           288 |      0.00%</h2><p>应用died的时候会主动释放:</p>
<p>01-02 12:44:01.223   746  1581 W jackywei: removeWindowToken<br>01-02 12:44:01.225   746  1581 W jackywei: java.lang.Throwable<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.wm.DisplayContent.removeWindowToken(DisplayContent.java:832)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.wm.DisplayContent.removeAppToken(DisplayContent.java:858)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.wm.AppWindowContainerController.removeContainer(AppWindowContainerController.java:246)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityRecord.removeWindowContainer(ActivityRecord.java:1001)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityStack.removeActivityFromHistoryLocked(ActivityStack.java:4169)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityStack.removeHistoryRecordsForAppLocked(ActivityStack.java:4544)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityStack.handleAppDiedLocked(ActivityStack.java:5095)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityStackSupervisor.handleAppDiedLocked(ActivityStackSupervisor.java:2008)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityManagerService.handleAppDiedLocked(ActivityManagerService.java:5413)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityManagerService.appDiedLocked(ActivityManagerService.java:5594)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityManagerService$AppDeathRecipient.binderDied(ActivityManagerService.java:1641)<br>01-02 12:44:01.225   746  1581 W jackywei:     at android.os.BinderProxy.sendDeathNotice(Binder.java:844)<br>01-02 12:44:01.226   746  1581 W jackywei: ++++++++++++++++++++removeWindowToken++++++++++++++++++++<br>01-02 12:44:01.227   746  1581 W jackywei: removeWindowToken<br>01-02 12:44:01.228   746  1581 W jackywei: java.lang.Throwable<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.DisplayContent.removeWindowToken(DisplayContent.java:832)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.WindowToken.removeImmediately(WindowToken.java:239)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.AppWindowToken.removeImmediately(AppWindowToken.java:528)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.AppWindowToken.removeIfPossible(AppWindowToken.java:535)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.AppWindowToken.onRemovedFromDisplay(AppWindowToken.java:601)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.DisplayContent.removeAppToken(DisplayContent.java:871)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.AppWindowContainerController.removeContainer(AppWindowContainerController.java:246)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityRecord.removeWindowContainer(ActivityRecord.java:1001)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityStack.removeActivityFromHistoryLocked(ActivityStack.java:4169)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityStack.removeHistoryRecordsForAppLocked(ActivityStack.java:4544)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityStack.handleAppDiedLocked(ActivityStack.java:5095)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityStackSupervisor.handleAppDiedLocked(ActivityStackSupervisor.java:2008)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityManagerService.handleAppDiedLocked(ActivityManagerService.java:5413)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityManagerService.appDiedLocked(ActivityManagerService.java:5594)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityManagerService$AppDeathRecipient.binderDied(ActivityManagerService.java:1641)<br>01-02 12:44:01.228   746  1581 W jackywei:     at android.os.BinderProxy.sendDeathNotice(Binder.java:844)<br>01-02 12:44:01.228   746  1581 W jackywei: ++++++++++++++++++++removeWindowToken++++++++++++++++++++</p>
<p>ActivityManagerService.java:</p>
<p>private final void handleAppDiedLocked(ProcessRecord app,<br>            boolean restarting, boolean allowRestart) {</p>
<p>// Remove this application’s activities from active lists.<br>boolean hasVisibleActivities = mStackSupervisor.handleAppDiedLocked(app);</p>
<p>——–&gt;</p>
<p>ActivityStackSupervisor.java:<br>boolean handleAppDiedLocked(ProcessRecord app) {<br>    boolean hasVisibleActivities = false;<br>    for (int displayNdx = mActivityDisplays.size() - 1; displayNdx &gt;= 0; –displayNdx) {<br>        final ArrayList<activitystack> stacks = mActivityDisplays.valueAt(displayNdx).mStacks;<br>        for (int stackNdx = stacks.size() - 1; stackNdx &gt;= 0; –stackNdx) {<br>            hasVisibleActivities |= stacks.get(stackNdx).handleAppDiedLocked(app);<br>        }<br>    }<br>    return hasVisibleActivities;<br>}</activitystack></p>
<p>mActivityDisplays ? 大小:mSize = 1</p>
<h2 id="Type-Name-Value-2"><a href="#Type-Name-Value-2" class="headerlink" title="Type|Name             |Value"></a>Type|Name             |Value</h2><h2 id="ref-mActivityDisplays-android-util-SparseArray-0x14bc0ad0"><a href="#ref-mActivityDisplays-android-util-SparseArray-0x14bc0ad0" class="headerlink" title="ref |mActivityDisplays|android.util.SparseArray @ 0x14bc0ad0"></a>ref |mActivityDisplays|android.util.SparseArray @ 0x14bc0ad0</h2><h2 id="Type-Name-Value-3"><a href="#Type-Name-Value-3" class="headerlink" title="Type   |Name            |Value"></a>Type   |Name            |Value</h2><p>boolean|mGarbage        |false<br>ref    |mKeys           |int[11] @ 0x14bd1160<br>int    |mSize           |1<br>ref    |mValues         |java.lang.Object[11] @ 0x14bd1198<br>ref    |shadow$<em>klass</em>  |class android.util.SparseArray @ 0x7036c860</p>
<h2 id="int-shadow-monitor-0"><a href="#int-shadow-monitor-0" class="headerlink" title="int    |shadow$monitor|0"></a>int    |shadow$<em>monitor</em>|0</h2><p>大小:mSize = 1<br>boolean handleAppDiedLocked(ProcessRecord app) {<br>    boolean hasVisibleActivities = false;<br>    for (int displayNdx = mActivityDisplays.size() - 1; displayNdx &gt;= 0; –displayNdx) {<br>        final ArrayList<activitystack> stacks = mActivityDisplays.valueAt(displayNdx).mStacks;<br>        for (int stackNdx = stacks.size() - 1; stackNdx &gt;= 0; –stackNdx) {<br>            hasVisibleActivities |= stacks.get(stackNdx).handleAppDiedLocked(app);<br>        }<br>    }<br>    return hasVisibleActivities;<br>}</activitystack></p>
<h2 id="Type-Name-Value-4"><a href="#Type-Name-Value-4" class="headerlink" title="Type|Name   |Value"></a>Type|Name   |Value</h2><h2 id="ref-mStacks-java-util-ArrayList-0x12dc5ec0"><a href="#ref-mStacks-java-util-ArrayList-0x12dc5ec0" class="headerlink" title="ref |mStacks|java.util.ArrayList @ 0x12dc5ec0"></a>ref |mStacks|java.util.ArrayList @ 0x12dc5ec0</h2><p>mStacks: size 3</p>
<h2 id="Type-Name-Value-5"><a href="#Type-Name-Value-5" class="headerlink" title="Type|Name            |Value"></a>Type|Name            |Value</h2><p>ref |elementData     |java.lang.Object[10] @ 0x12dc61c0<br>int |size            |3<br>int |modCount        |12097<br>ref |shadow$<em>klass</em>  |class java.util.ArrayList @ 0x6ff70c38</p>
<h2 id="int-shadow-monitor-0-1"><a href="#int-shadow-monitor-0-1" class="headerlink" title="int |shadow$monitor|0"></a>int |shadow$<em>monitor</em>|0</h2><p>———&gt;</p>
<p>ActivityStack.java :</p>
<p>boolean handleAppDiedLocked(ProcessRecord app) {<br>    if (mPausingActivity != null &amp;&amp; mPausingActivity.app == app) {<br>        if (DEBUG_PAUSE || DEBUG_CLEANUP) Slog.v(TAG_PAUSE,<br>                “App died while pausing: “ + mPausingActivity);<br>        mPausingActivity = null;<br>    }<br>    if (mLastPausedActivity != null &amp;&amp; mLastPausedActivity.app == app) {<br>        mLastPausedActivity = null;<br>        mLastNoHistoryActivity = null;<br>    }</p>
<pre><code>return removeHistoryRecordsForAppLocked(app);
</code></pre><p>}</p>
<p>private boolean removeHistoryRecordsForAppLocked(ProcessRecord app) {<br>    removeHistoryRecordsForAppLocked(mLRUActivities, app, “mLRUActivities”);<br>    removeHistoryRecordsForAppLocked(mStackSupervisor.mStoppingActivities, app,<br>            “mStoppingActivities”);<br>    removeHistoryRecordsForAppLocked(mStackSupervisor.mGoingToSleepActivities, app,<br>            “mGoingToSleepActivities”);<br>    removeHistoryRecordsForAppLocked(mStackSupervisor.mActivitiesWaitingForVisibleActivity, app,<br>            “mActivitiesWaitingForVisibleActivity”);<br>    removeHistoryRecordsForAppLocked(mStackSupervisor.mFinishingActivities, app,<br>            “mFinishingActivities”);</p>
<pre><code>boolean hasVisibleActivities = false;

// Clean out the history list.
int i = numActivities();
if (DEBUG_CLEANUP) Slog.v(TAG_CLEANUP,
        &quot;Removing app &quot; + app + &quot; from history with &quot; + i + &quot; entries&quot;);
for (int taskNdx = mTaskHistory.size() - 1; taskNdx &gt;= 0; --taskNdx) {
    final ArrayList&lt;ActivityRecord&gt; activities = mTaskHistory.get(taskNdx).mActivities;
    for (int activityNdx = activities.size() - 1; activityNdx &gt;= 0; --activityNdx) {
        final ActivityRecord r = activities.get(activityNdx);
        --i;
        if (DEBUG_CLEANUP) Slog.v(TAG_CLEANUP,
                &quot;Record #&quot; + i + &quot; &quot; + r + &quot;: app=&quot; + r.app);
        if (r.app == app) {//如果这里没有相等的APP实例,remove 就一直是 false.
            if (r.visible) {
                hasVisibleActivities = true;
            }
            final boolean remove;
            if ((!r.haveState &amp;&amp; !r.stateNotNeeded) || r.finishing) {//这里的三个状态
                // Don&apos;t currently have state for the activity, or
                // it is finishing -- always remove it.
                remove = true;
            } else if (!r.visible &amp;&amp; r.launchCount &gt; 2 &amp;&amp;
                    r.lastLaunchTime &gt; (SystemClock.uptimeMillis() - 60000)) {
                // We have launched this activity too many times since it was
                // able to run, so give up and remove it.
                // (Note if the activity is visible, we don&apos;t remove the record.
                // We leave the dead window on the screen but the process will
                // not be restarted unless user explicitly tap on it.)
                remove = true;
            } else {
                // The process may be gone, but the activity lives on!
                remove = false;
            }
            if (remove) {
                if (DEBUG_ADD_REMOVE || DEBUG_CLEANUP) Slog.i(TAG_ADD_REMOVE,
                        &quot;Removing activity &quot; + r + &quot; from stack at &quot; + i
                        + &quot;: haveState=&quot; + r.haveState
                        + &quot; stateNotNeeded=&quot; + r.stateNotNeeded
                        + &quot; finishing=&quot; + r.finishing
                        + &quot; state=&quot; + r.state + &quot; callers=&quot; + Debug.getCallers(5));
                if (!r.finishing) {
                    Slog.w(TAG, &quot;Force removing &quot; + r + &quot;: app died, no saved state&quot;);
                    EventLog.writeEvent(EventLogTags.AM_FINISH_ACTIVITY,
                            r.userId, System.identityHashCode(r),
                            r.getTask().taskId, r.shortComponentName,
                            &quot;proc died without state saved&quot;);
                    if (r.state == ActivityState.RESUMED) {
                        mService.updateUsageStats(r, false);
                    }
                }
            } else {
                // We have the current state for this activity, so
                // it can be restarted later when needed.
                if (DEBUG_ALL) Slog.v(TAG, &quot;Keeping entry, setting app to null&quot;);
                if (DEBUG_APP) Slog.v(TAG_APP,
                        &quot;Clearing app during removeHistory for activity &quot; + r);
                r.app = null;
                // Set nowVisible to previous visible state. If the app was visible while
                // it died, we leave the dead window on screen so it&apos;s basically visible.
                // This is needed when user later tap on the dead window, we need to stop
                // other apps when user transfers focus to the restarted activity.
                r.nowVisible = r.visible;
                if (!r.haveState) {
                    if (DEBUG_SAVED_STATE) Slog.i(TAG_SAVED_STATE,
                            &quot;App died, clearing saved state of &quot; + r);
                    r.icicle = null;
                }
            }
            cleanUpActivityLocked(r, true, true);
            if (remove) {
                removeActivityFromHistoryLocked(r, &quot;appDied&quot;);//在这里会释放removeWindowToken
            }
        }
    }
}

return hasVisibleActivities;
</code></pre><p>}</p>
<p>private void removeHistoryRecordsForAppLocked(ArrayList<activityrecord> list,<br>        ProcessRecord app, String listName) {<br>    int i = list.size();<br>    if (DEBUG_CLEANUP) Slog.v(TAG_CLEANUP,<br>        “Removing app “ + app + “ from list “ + listName + “ with “ + i + “ entries”);<br>    while (i &gt; 0) {<br>        i–;<br>        ActivityRecord r = list.get(i);<br>        if (DEBUG_CLEANUP) Slog.v(TAG_CLEANUP, “Record #” + i + “ “ + r);<br>        if (r.app == app) {<br>            if (DEBUG_CLEANUP) Slog.v(TAG_CLEANUP, “—&gt; REMOVING this entry!”);<br>            list.remove(i);<br>            removeTimeoutsForActivityLocked(r);<br>        }<br>    }<br>}</activityrecord></p>
<h2 id="Class-Name-Shallow-Heap-Retained-Heap-Percentage-1"><a href="#Class-Name-Shallow-Heap-Retained-Heap-Percentage-1" class="headerlink" title="Class Name                                       | Shallow Heap | Retained Heap | Percentage"></a>Class Name                                       | Shallow Heap | Retained Heap | Percentage</h2><h2 id="com-android-server-am-ActivityRecord-0x14bf1378-384-3-208-0-01"><a href="#com-android-server-am-ActivityRecord-0x14bf1378-384-3-208-0-01" class="headerlink" title="com.android.server.am.ActivityRecord @ 0x14bf1378|          384 |         3,208 |      0.01%"></a>com.android.server.am.ActivityRecord @ 0x14bf1378|          384 |         3,208 |      0.01%</h2><h2 id="Type-Name-Value-6"><a href="#Type-Name-Value-6" class="headerlink" title="Type   |Name                             |Value"></a>Type   |Name                             |Value</h2><p>ref    |app                              |null<br>ref    |appInfo                          |android.content.pm.ApplicationInfo @ 0x12de8bb8<br>ref    |appTimeTracker                   |null<br>ref    |appToken                         |com.android.server.am.ActivityRecord$Token @ 0x14bf0340<br>ref    |compat                           |android.content.res.CompatibilityInfo @ 0x14bf1548<br>boolean|componentSpecified               |false<br>int    |configChangeFlags                |0<br>ref    |connections                      |null<br>long   |cpuTimeAtResume                  |0<br>long   |createTime                       |1529665655297<br>boolean|deferRelaunchUntilPaused         |false<br>boolean|delayedResume                    |false<br>long   |displayStartTime                 |0<br>boolean|finishing                        |false<br>boolean|forceNewConfig                   |false<br>boolean|frontOfTask                      |false<br>boolean|frozenBeforeDestroy              |false<br>boolean|fullscreen                       |true<br>long   |fullyDrawnStartTime              |0<br>boolean|hasBeenLaunched                  |true<br>boolean|haveState                        |true<br>ref    |icicle                           |android.os.Bundle @ 0x14bf1560<br>int    |icon                             |2130903043<br>boolean|idle                             |true<br>boolean|immersive                        |false<br>boolean|inHistory                        |true<br>ref    |info                             |android.content.pm.ActivityInfo @ 0x149cd150<br>ref    |intent                           |android.content.Intent @ 0x14bf1578<br>boolean|keysPaused                       |false<br>int    |labelRes                         |2131954418<br>long   |lastLaunchTime                   |82773638<br>long   |lastVisibleTime                  |82780913<br>int    |launchCount                      |0<br>boolean|launchFailed                     |false<br>int    |launchMode                       |0<br>long   |launchTickTime                   |0<br>ref    |launchedFromPackage              |java.lang.String @ 0x14bf15b8<br>int    |launchedFromPid                  |-1<br>int    |launchedFromUid                  |10036<br>boolean|launching                        |true<br>int    |logo                             |2130903043<br>int    |mActivityType                    |0<br>ref    |mBounds                          |android.graphics.Rect @ 0x14bf15e0<br>boolean|mDeferHidingClient               |false<br>ref    |mHorizontalSizeConfigurations    |int[5] @ 0x14bf15f8<br>ref    |mLastReportedConfiguration       |android.util.MergedConfiguration @ 0x14bf1618<br>int    |mLastReportedDisplayId           |0<br>boolean|mLastReportedMultiWindowMode     |false<br>boolean|mLastReportedPictureInPictureMode|false<br>boolean|mLaunchTaskBehind                |false<br>ref    |mPerf                            |android.util.BoostFramework @ 0x14bf1630<br>ref    |mPerf_iop                        |android.util.BoostFramework @ 0x14bf1640<br>int    |mRotationAnimationHint           |-1<br>boolean|mShowWhenLocked                  |false<br>ref    |mSmallestSizeConfigurations      |int[8] @ 0x14bf1650<br>ref    |mStackSupervisor                 |com.android.server.am.ActivityStackSupervisor @ 0x12dc5dd8<br>int    |mStartingWindowState             |2<br>boolean|mTaskOverlay                     |false<br>ref    |mTmpBounds                       |android.graphics.Rect @ 0x14bf1680<br>ref    |mTmpConfig                       |android.content.res.Configuration @ 0x14bf1698<br>boolean|mTurnScreenOn                    |false<br>boolean|mUpdateTaskThumbnailWhenHidden   |false<br>ref    |mUxPerf                          |android.util.BoostFramework @ 0x14bf1708<br>ref    |mVerticalSizeConfigurations      |int[4] @ 0x14bf1718<br>ref    |mWindowContainerController       |com.android.server.wm.AppWindowContainerController @ 0x14bf00e0<br>ref    |newIntents                       |null<br>boolean|noDisplay                        |false<br>ref    |nonLocalizedLabel                |null<br>boolean|nowVisible                       |false<br>ref    |packageName                      |java.lang.String @ 0x12dd83d8<br>long   |pauseTime                        |82807597<br>ref    |pendingOptions                   |android.app.ActivityOptions @ 0x14bf1738<br>ref    |pendingResults                   |null<br>boolean|pendingVoiceInteractionStart     |false<br>int    |perfActivityBoostHandler         |-1<br>ref    |persistentState                  |null<br>ref    |pictureInPictureArgs             |android.app.PictureInPictureParams @ 0x14bf17b0<br>boolean|preserveWindowOnDeferredRelaunch |false<br>ref    |processName                      |java.lang.String @ 0x12dd83d8<br>ref    |realActivity                     |android.content.ComponentName @ 0x14bf17c8<br>int    |realTheme                        |2132017768<br>int    |requestCode                      |0<br>ref    |requestedVrComponent             |null<br>ref    |resolvedType                     |java.lang.String @ 0x14bf17d8<br>ref    |resultTo                         |null<br>ref    |resultWho                        |null<br>ref    |results                          |null<br>ref    |returningOptions                 |null<br>boolean|rootVoiceInteraction             |false<br>ref    |service                          |com.android.server.am.ActivityManagerService @ 0x12cd3f10<br>ref    |shortComponentName               |java.lang.String @ 0x14bf17f8<br>boolean|sleeping                         |false<br>long   |startTime                        |0<br>ref    |state                            |com.android.server.am.ActivityStack$ActivityState @ 0x12dc97b0<br>boolean|stateNotNeeded                   |false<br>boolean|stopped                          |true<br>ref    |stringName                       |java.lang.String @ 0x14bf1848<br>boolean|supportsEnterPipOnTaskSwitch     |true<br>ref    |task                             |com.android.server.am.TaskRecord @ 0x14bd2bf0<br>ref    |taskAffinity                     |java.lang.String @ 0x12dd83d8<br>ref    |taskDescription                  |android.app.ActivityManager$TaskDescription @ 0x14bf18b0<br>int    |theme                            |2132017768<br>ref    |uriPermissions                   |com.android.server.am.UriPermissionOwner @ 0x14bf18d8<br>int    |userId                           |0<br>boolean|visible                          |false<br>boolean|visibleIgnoringKeyguard          |false<br>ref    |voiceSession                     |null<br>int    |windowFlags                      |16777216<br>ref    |mFullConfiguration               |android.content.res.Configuration @ 0x14bf18f8<br>ref    |mMergedOverrideConfiguration     |android.content.res.Configuration @ 0x14bf1968<br>ref    |mOverrideConfiguration           |android.content.res.Configuration @ 0x14bf19d8<br>ref    |shadow$<em>klass</em>                   |class com.android.server.am.ActivityRecord @ 0x75a57328</p>
<h2 id="int-shadow-monitor-1950625590"><a href="#int-shadow-monitor-1950625590" class="headerlink" title="int    |shadow$monitor                 |-1950625590"></a>int    |shadow$<em>monitor</em>                 |-1950625590</h2><p>android@NSGWD180021:/data/workspace/issueAnalysis/system_server_memory_leak/0625$ adb shell ps | grep -i process<br>u0_a18         499   276 1063700  24232 SyS_epoll_wait aa9e3658 S com.google.process.gservices<br>u0_a55        2683   276 1056528  21044 SyS_epoll_wait aa9e3658 S com.google.process.gapps<br>u0_a18        2693   276 1059040  25804 SyS_epoll_wait aa9e3658 S com.google.process.gapps<br>u0_a1         2871   276 1056696  26984 SyS_epoll_wait aa9e3658 S android.process.acore<br>u0_i460       3264   276 1062668  22268 SyS_epoll_wait aa9e3658 S com.android.chrome:sandboxed_process0<br>u0_a12        3977   276 1072972  32456 SyS_epoll_wait aa9e3658 S android.process.media</p>
<p>#################################################################################################################</p>
<h2 id="Class-Name-Ref-Objects-Shallow-Heap-Ref-Shallow-Heap-Retained-Heap-4"><a href="#Class-Name-Ref-Objects-Shallow-Heap-Ref-Shallow-Heap-Retained-Heap-4" class="headerlink" title="Class Name                                                                              | Ref. Objects | Shallow Heap | Ref. Shallow Heap | Retained Heap"></a>Class Name                                                                              | Ref. Objects | Shallow Heap | Ref. Shallow Heap | Retained Heap</h2><p>com.android.server.wm.WindowManagerService @ 0x12cd2950 Native Stack                    |            1 |          512 |               440 |         5,064<br>‘- mFocusedApp com.android.server.wm.AppWindowToken @ 0x14bc22d8                        |            1 |          200 |               440 |         1,256<br>   ‘- mDisplayContent com.android.server.wm.DisplayContent @ 0x12db7bd0                 |            1 |          312 |               440 |        58,344<br>      ‘- mTokenMap java.util.HashMap @ 0x12db86a0                                       |            1 |           40 |               440 |        30,248<br>         ‘- table java.util.HashMap$Node[2048] @ 0x12db91f8                             |            1 |        8,208 |               440 |        30,192<br>            ‘- [1941] java.util.HashMap$Node @ 0x12dbf468                               |            1 |           24 |               440 |            24<br>               ‘- value com.android.server.wm.AppWindowToken @ 0x12e960b0               |            1 |          200 |               440 |         1,272<br>                  ‘- mAppAnimator com.android.server.wm.AppWindowAnimator @ 0x12e96a70  |            1 |           96 |               440 |           288<br>                     ‘- mAllAppWinAnimators java.util.ArrayList @ 0x12e96c88            |            1 |           24 |               440 |            80<br>                        ‘- elementData java.lang.Object[10] @ 0x12e96d30                |            1 |           56 |               440 |            56<br>                           ‘- [0] com.android.server.wm.WindowStateAnimator @ 0x12e96d68|            1 |          224 |               440 |           544</p>
<pre><code>&apos;- mWin com.android.server.wm.WindowState @ 0x12e96f70    |            1 |          440 |               440 |         2,496
</code></pre><hr>
<p>mTokenMap</p>
<h2 id="Class-Name-Shallow-Heap-Retained-Heap-2"><a href="#Class-Name-Shallow-Heap-Retained-Heap-2" class="headerlink" title="Class Name                                                                            | Shallow Heap | Retained Heap"></a>Class Name                                                                            | Shallow Heap | Retained Heap</h2><h2 id="mPidsSelfLocked-com-android-server-am-ActivityManagerService-0x12cd3f10-Native-Stack-800-329-472"><a href="#mPidsSelfLocked-com-android-server-am-ActivityManagerService-0x12cd3f10-Native-Stack-800-329-472" class="headerlink" title="mPidsSelfLocked com.android.server.am.ActivityManagerService @ 0x12cd3f10 Native Stack|          800 |       329,472"></a>mPidsSelfLocked com.android.server.am.ActivityManagerService @ 0x12cd3f10 Native Stack|          800 |       329,472</h2><h2 id="Class-Name-Shallow-Heap-Retained-Heap-3"><a href="#Class-Name-Shallow-Heap-Retained-Heap-3" class="headerlink" title="Class Name                            | Shallow Heap | Retained Heap"></a>Class Name                            | Shallow Heap | Retained Heap</h2><h2 id="36-java-lang-Object-95-0x1563f618-392-392"><a href="#36-java-lang-Object-95-0x1563f618-392-392" class="headerlink" title="[36] java.lang.Object[95] @ 0x1563f618|          392 |           392"></a>[36] java.lang.Object[95] @ 0x1563f618|          392 |           392</h2><p>I use the sdk tools catch the systrace log ,the log indicate that the android.anim thread spend a lot of cpu time.<br>And I catch the traceview log, the log indicate that the com.android.server.wm.WindowContainer.forAllWindows function spend a lot of time to run in the android.anim thread.</p>
<p>And I catch the window service log,show that there are so lot of AppWindowToken is not released.</p>
<p>直接debug system_server 看能否释放</p>
<p>sudo mount -t cifs -o username=”android”,password=”mobile#5” //10.1.6.36/android /mnt/10.1.6.36</p>
<h1 id="用eclipse远程调试"><a href="#用eclipse远程调试" class="headerlink" title="用eclipse远程调试"></a>用eclipse远程调试</h1><h1 id="删除一个APP-看能否-正常释放"><a href="#删除一个APP-看能否-正常释放" class="headerlink" title="删除一个APP 看能否 正常释放:"></a>删除一个APP 看能否 正常释放:</h1><p>01-02 12:44:01.223   746  1581 W jackywei: removeWindowToken<br>01-02 12:44:01.225   746  1581 W jackywei: java.lang.Throwable<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.wm.DisplayContent.removeWindowToken(DisplayContent.java:832)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.wm.DisplayContent.removeAppToken(DisplayContent.java:858)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.wm.AppWindowContainerController.removeContainer(AppWindowContainerController.java:246)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityRecord.removeWindowContainer(ActivityRecord.java:1001)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityStack.removeActivityFromHistoryLocked(ActivityStack.java:4169)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityStack.removeHistoryRecordsForAppLocked(ActivityStack.java:4544)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityStack.handleAppDiedLocked(ActivityStack.java:5095)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityStackSupervisor.handleAppDiedLocked(ActivityStackSupervisor.java:2008)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityManagerService.handleAppDiedLocked(ActivityManagerService.java:5413)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityManagerService.appDiedLocked(ActivityManagerService.java:5594)<br>01-02 12:44:01.225   746  1581 W jackywei:     at com.android.server.am.ActivityManagerService$AppDeathRecipient.binderDied(ActivityManagerService.java:1641)<br>01-02 12:44:01.225   746  1581 W jackywei:     at android.os.BinderProxy.sendDeathNotice(Binder.java:844)<br>01-02 12:44:01.226   746  1581 W jackywei: ++++++++++++++++++++removeWindowToken++++++++++++++++++++<br>01-02 12:44:01.227   746  1581 W jackywei: removeWindowToken<br>01-02 12:44:01.228   746  1581 W jackywei: java.lang.Throwable<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.DisplayContent.removeWindowToken(DisplayContent.java:832)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.WindowToken.removeImmediately(WindowToken.java:239)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.AppWindowToken.removeImmediately(AppWindowToken.java:528)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.AppWindowToken.removeIfPossible(AppWindowToken.java:535)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.AppWindowToken.onRemovedFromDisplay(AppWindowToken.java:601)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.DisplayContent.removeAppToken(DisplayContent.java:871)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.wm.AppWindowContainerController.removeContainer(AppWindowContainerController.java:246)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityRecord.removeWindowContainer(ActivityRecord.java:1001)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityStack.removeActivityFromHistoryLocked(ActivityStack.java:4169)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityStack.removeHistoryRecordsForAppLocked(ActivityStack.java:4544)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityStack.handleAppDiedLocked(ActivityStack.java:5095)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityStackSupervisor.handleAppDiedLocked(ActivityStackSupervisor.java:2008)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityManagerService.handleAppDiedLocked(ActivityManagerService.java:5413)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityManagerService.appDiedLocked(ActivityManagerService.java:5594)<br>01-02 12:44:01.228   746  1581 W jackywei:     at com.android.server.am.ActivityManagerService$AppDeathRecipient.binderDied(ActivityManagerService.java:1641)<br>01-02 12:44:01.228   746  1581 W jackywei:     at android.os.BinderProxy.sendDeathNotice(Binder.java:844)<br>01-02 12:44:01.228   746  1581 W jackywei: ++++++++++++++++++++removeWindowToken++++++++++++++++++++</p>
<p>DisplayContent.forAllWindows(ToBooleanFunction, boolean) line: 1525<br>DisplayContent.findFocusedWindow() line: 2265<br>RootWindowContainer.computeFocusedWindow() line: 170<br>WindowManagerService.updateFocusedWindowLocked(int, boolean) line: 5993<br>DisplayContent.layoutAndAssignWindowLayersIfNeeded() line: 2289<br>StackWindowController.positionChildAtTop(TaskWindowContainerController, boolean) line: 159<br>ActivityStack.insertTaskAtTop(TaskRecord, ActivityRecord) line: 2844<br>ActivityStack.moveTaskToFrontLocked(TaskRecord, boolean, ActivityOptions, AppTimeTracker, String) line: 4620<br>ActivityStarter.setTargetStackAndMoveToFrontIfNeeded(ActivityRecord) line: 1613<br>ActivityStarter.startActivityUnchecked(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1096<br>ActivityStarter.startActivity(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1000<br>ActivityStarter.startActivity(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord) line: 577<br>ActivityStarter.startActivityLocked(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord, String) line: 283<br>ActivityStarter.startActivityMayWait(IApplicationThread, int, String, Intent, String, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, ProfilerInfo, WaitResult, Configuration, Bundle, boolean, int, TaskRecord, String) line: 822<br>ActivityManagerService.startActivityAsUser(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle, int) line: 4622<br>ActivityManagerService.startActivity(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle) line: 4609<br>ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 121<br>ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>Thread [Binder:923_1B] (Suspended (breakpoint at line 3402 in DisplayContent$TaskStackContainers))<br>    owns: WindowHashMap  (id=10090)<br>    owns: ActivityManagerService  (id=165)<br>    DisplayContent$TaskStackContainers.forAllWindows(ToBooleanFunction, boolean) line: 3402<br>    DisplayContent.forAllWindows(ToBooleanFunction, boolean) line: 1533<br>    DisplayContent.findFocusedWindow() line: 2265<br>    RootWindowContainer.computeFocusedWindow() line: 170<br>    WindowManagerService.updateFocusedWindowLocked(int, boolean) line: 5993<br>    DisplayContent.layoutAndAssignWindowLayersIfNeeded() line: 2289<br>    StackWindowController.positionChildAtTop(TaskWindowContainerController, boolean) line: 159<br>    ActivityStack.insertTaskAtTop(TaskRecord, ActivityRecord) line: 2844<br>    ActivityStack.moveTaskToFrontLocked(TaskRecord, boolean, ActivityOptions, AppTimeTracker, String) line: 4620<br>    ActivityStarter.setTargetStackAndMoveToFrontIfNeeded(ActivityRecord) line: 1613<br>    ActivityStarter.startActivityUnchecked(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1096<br>    ActivityStarter.startActivity(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1000<br>    ActivityStarter.startActivity(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord) line: 577<br>    ActivityStarter.startActivityLocked(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord, String) line: 283<br>    ActivityStarter.startActivityMayWait(IApplicationThread, int, String, Intent, String, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, ProfilerInfo, WaitResult, Configuration, Bundle, boolean, int, TaskRecord, String) line: 822<br>    ActivityManagerService.startActivityAsUser(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle, int) line: 4622<br>    ActivityManagerService.startActivity(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle) line: 4609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 121<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>Thread [android.anim] (Suspended (breakpoint at line 400 in InputMonitor))<br>    owns: WindowHashMap  (id=10090)<br>    InputMonitor.updateInputWindowsLw(boolean) line: 400<br>    WindowManagerService.relayoutWindow(Session, IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 2241<br>    Session.relayout(IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 239<br>    ViewRootImpl.relayoutWindow(WindowManager$LayoutParams, int, boolean) line: 6141<br>    ViewRootImpl.performTraversals() line: 1905<br>    ViewRootImpl.doTraversal() line: 1396<br>    ViewRootImpl$TraversalRunnable.run() line: 6773<br>    Choreographer$CallbackRecord.run(long) line: 966<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 713<br>    Choreographer$FrameDisplayEventReceiver.run() line: 952<br>    Handler.handleCallback(Message) line: 790<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>Thread [android.anim] (Suspended (breakpoint at line 632 in WindowContainer))<br>    owns: WindowHashMap  (id=10090)<br>    DisplayContent(WindowContainer).forAllWindows(Consumer, boolean) line: 632<br>    DisplayContent.updateWindowsForAnimator(WindowAnimator) line: 2616<br>    WindowAnimator.animate(long) line: 201<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameDisplayEventReceiver.run() line: 952<br>    Handler.handleCallback(Message) line: 790<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>Thread [android.anim] (Suspended (breakpoint at line 1525 in DisplayContent))<br>    owns: WindowHashMap  (id=10090)<br>    DisplayContent.forAllWindows(ToBooleanFunction, boolean) line: 1525<br>    DisplayContent(WindowContainer).forAllWindows(Consumer, boolean) line: 633<br>    DisplayContent.prepareWindowSurfaces() line: 2637<br>    WindowAnimator.animate(long) line: 203<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameDisplayEventReceiver.run() line: 952<br>    Handler.handleCallback(Message) line: 790<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<h1 id="查-看traceview-文件再分析一下"><a href="#查-看traceview-文件再分析一下" class="headerlink" title="查 看traceview 文件再分析一下"></a>查 看traceview 文件再分析一下</h1><h1 id="animate"><a href="#animate" class="headerlink" title="animate"></a>animate</h1><p>traceview 显示 animate 占了很大一部分运行时间CPU时间</p>
<pre><code>    mAnimationFrameCallback = frameTimeNs -&gt; {
        synchronized (mService.mWindowMap) {
            mAnimationFrameCallbackScheduled = false;
        }
        animate(frameTimeNs);
    };


void scheduleAnimation() {
    if (!mAnimationFrameCallbackScheduled) {
        mAnimationFrameCallbackScheduled = true;
        mChoreographer.postFrameCallback(mAnimationFrameCallback); //放到渲染线程里面
    }
}

private void cancelAnimation() {
    if (mAnimationFrameCallbackScheduled) {
        mAnimationFrameCallbackScheduled = false;
        mChoreographer.removeFrameCallback(mAnimationFrameCallback);//移出渲染线程里面
    }
}


private void animate(long frameTimeNs) {

    synchronized (mService.mWindowMap) {
        if (!mInitialized) {
            return;
        }

        // Schedule next frame already such that back-pressure happens continuously
        scheduleAnimation();//animate每次都会调用
    }
</code></pre><p>mAnimationFrameCallbackScheduled 很重要,cancelAnimation()才能致 false</p>
<p>//下面的代码才能调 cancelAnimation<br>                if (mService.mDragState != null) {<br>                    mAnimating |= mService.mDragState.stepAnimationLocked(mCurrentTime);<br>                }</p>
<pre><code>            if (!mAnimating) {
                cancelAnimation();
            }




private final Consumer&lt;WindowState&gt; mUpdateWallpaperForAnimator = w -&gt; {
    final WindowStateAnimator winAnimator = w.mWinAnimator;
    if (winAnimator.mSurfaceController == null || !winAnimator.hasSurface()) {
        return;
    }

    final int flags = w.mAttrs.flags;

    // If this window is animating, make a note that we have an animating window and take
    // care of a request to run a detached wallpaper animation.
    if (winAnimator.mAnimating) {
        if (winAnimator.mAnimation != null) {
            if ((flags &amp; FLAG_SHOW_WALLPAPER) != 0
                    &amp;&amp; winAnimator.mAnimation.getDetachWallpaper()) {
                mTmpWindow = w;
            }
            final int color = winAnimator.mAnimation.getBackgroundColor();
            if (color != 0) {
                final TaskStack stack = w.getStack();
                if (stack != null) {
                    stack.setAnimationBackground(winAnimator, color);
                }
            }
        }
        mTmpWindowAnimator.setAnimating(true);
    }

    // If this window&apos;s app token is running a detached wallpaper animation, make a note so
    // we can ensure the wallpaper is displayed behind it.
    final AppWindowAnimator appAnimator = winAnimator.mAppAnimator;
    if (appAnimator != null &amp;&amp; appAnimator.animation != null
            &amp;&amp; appAnimator.animating) {
        if ((flags &amp; FLAG_SHOW_WALLPAPER) != 0
                &amp;&amp; appAnimator.animation.getDetachWallpaper()) {
            mTmpWindow = w;
        }

        final int color = appAnimator.animation.getBackgroundColor();
        if (color != 0) {
            final TaskStack stack = w.getStack();
            if (stack != null) {
                stack.setAnimationBackground(winAnimator, color);
            }
        }
    }
};




@Override
boolean forAllWindows(ToBooleanFunction&lt;WindowState&gt; callback, boolean traverseTopToBottom) {
    if (mChildren.isEmpty()) {
        // The window has no children so we just return it.
        return applyInOrderWithImeWindows(callback, traverseTopToBottom);// 这里?
    }

    if (traverseTopToBottom) {
        return forAllWindowTopToBottom(callback);
    } else {
        return forAllWindowBottomToTop(callback);
    }
}


private final Consumer&lt;WindowState&gt; mUpdateWallpaperForAnimator = w -&gt; {
    final WindowStateAnimator winAnimator = w.mWinAnimator;
    if (winAnimator.mSurfaceController == null || !winAnimator.hasSurface()) {
        return;
    }

    final int flags = w.mAttrs.flags;

    // If this window is animating, make a note that we have an animating window and take
    // care of a request to run a detached wallpaper animation.
    if (winAnimator.mAnimating) {// ?在这里?
        if (winAnimator.mAnimation != null) {
            if ((flags &amp; FLAG_SHOW_WALLPAPER) != 0
                    &amp;&amp; winAnimator.mAnimation.getDetachWallpaper()) {
                mTmpWindow = w;
            }
            final int color = winAnimator.mAnimation.getBackgroundColor();
            if (color != 0) {
                final TaskStack stack = w.getStack();
                if (stack != null) {
                    stack.setAnimationBackground(winAnimator, color);
                }
            }
        }
        mTmpWindowAnimator.setAnimating(true);
    }

    // If this window&apos;s app token is running a detached wallpaper animation, make a note so
    // we can ensure the wallpaper is displayed behind it.
    final AppWindowAnimator appAnimator = winAnimator.mAppAnimator;
    if (appAnimator != null &amp;&amp; appAnimator.animation != null
            &amp;&amp; appAnimator.animating) {
        if ((flags &amp; FLAG_SHOW_WALLPAPER) != 0
                &amp;&amp; appAnimator.animation.getDetachWallpaper()) {
            mTmpWindow = w;
        }

        final int color = appAnimator.animation.getBackgroundColor();
        if (color != 0) {
            final TaskStack stack = w.getStack();
            if (stack != null) {
                stack.setAnimationBackground(winAnimator, color);
            }
        }
    }
};
</code></pre><p>Thread [android.anim] (Suspended (breakpoint at line 435 in WindowAnimator))<br>    owns: WindowHashMap  (id=142)<br>    WindowAnimator.setAnimating(boolean) line: 435<br>    DisplayContent.lambda$-com_android_server_wm_DisplayContent_18415(WindowState) line: 408<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.$m$4(Object) line: not available<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.accept(Object) line: not available<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(WindowState) line: 779<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(Object) line: 777<br>    WindowState.applyInOrderWithImeWindows(ToBooleanFunction, boolean) line: 4128<br>    WindowState.forAllWindows(ToBooleanFunction, boolean) line: 4035<br>    AppWindowToken(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    AppWindowToken.forAllWindowsUnchecked(ToBooleanFunction, boolean) line: 1549<br>    AppWindowToken.forAllWindows(ToBooleanFunction, boolean) line: 1544<br>    Task(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    TaskStack(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$TaskStackContainers(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$TaskStackContainers.forAllWindows(ToBooleanFunction, boolean) line: 3405<br>    DisplayContent.forAllWindows(ToBooleanFunction, boolean) line: 1534<br>    DisplayContent(WindowContainer).forAllWindows(Consumer, boolean) line: 633<br>    DisplayContent.updateWallpaperForAnimator(WindowAnimator) line: 2628<br>    WindowAnimator.animate(long) line: 202<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameDisplayEventReceiver.run() line: 952<br>    Handler.handleCallback(Message) line: 790<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>private static final boolean OPTS_INPUT = SystemProperties.getBoolean(“persist.vendor.qti.inputopts.enable”,false);</p>
<p>//这个很关键???????<br>    // Enable/disable vsync for animations and drawing.<br>    private static final boolean USE_VSYNC = SystemProperties.getBoolean(<br>            “debug.choreographer.vsync”, true);</p>
<p>启动activity </p>
<p>Thread [Binder:3041_D] (Suspended)<br>    owns: Object  (id=374)<br>    owns: WindowHashMap  (id=142)<br>    owns: ActivityManagerService  (id=337)<br>    Choreographer.postCallbackDelayedInternal(int, Object, Object, long) line: 429<br>    Choreographer.postFrameCallbackDelayed(Choreographer$FrameCallback, long) line: 509<br>    Choreographer.postFrameCallback(Choreographer$FrameCallback) line: 489<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStarter.startActivity(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1010<br>    ActivityStarter.startActivity(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord) line: 577<br>    ActivityStarter.startActivityLocked(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord, String) line: 283<br>    ActivityStarter.startActivityMayWait(IApplicationThread, int, String, Intent, String, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, ProfilerInfo, WaitResult, Configuration, Bundle, boolean, int, TaskRecord, String) line: 822<br>    ActivityManagerService.startActivityAsUser(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle, int) line: 4622<br>    ActivityManagerService.startActivity(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle) line: 4609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 121<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>POWER ON  唤醒<br>Thread [PowerManagerService] (Suspended (breakpoint at line 426 in Choreographer))<br>    Choreographer.postCallbackDelayedInternal(int, Object, Object, long) line: 426<br>    Choreographer.postCallbackDelayed(int, Runnable, Object, long) line: 415<br>    Choreographer.postCallback(int, Runnable, Object) line: 389<br>    RampAnimator.postAnimationCallback() line: 124<br>    RampAnimator.animateTo(int, int) line: 103<br>    DisplayPowerController.animateScreenBrightness(int, int) line: 986<br>    DisplayPowerController.updatePowerState() line: 802<br>    DisplayPowerController.-wrap6(DisplayPowerController) line: not available<br>    DisplayPowerController$DisplayControllerHandler.handleMessage(Message) line: 1421<br>    DisplayPowerController$DisplayControllerHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    ServiceThread(HandlerThread).run() line: 65<br>    ServiceThread.run() line: 46    </p>
<hr>
<pre><code>@Override
boolean forAllWindows(ToBooleanFunction&lt;WindowState&gt; callback, boolean traverseTopToBottom) {
    if (mChildren.isEmpty()) {//这里递归返回
        // The window has no children so we just return it.
        return applyInOrderWithImeWindows(callback, traverseTopToBottom);
    }

    if (traverseTopToBottom) {
        return forAllWindowTopToBottom(callback);
    } else {
        return forAllWindowBottomToTop(callback);
    }
}
</code></pre><p>设置 setAnimating 的true<br>Thread [android.anim] (Suspended (breakpoint at line 435 in WindowAnimator))<br>    owns: WindowHashMap  (id=142)<br>    WindowAnimator.setAnimating(boolean) line: 435<br>    DisplayContent.lambda$-com_android_server_wm_DisplayContent_18415(WindowState) line: 408<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.$m$4(Object) line: not available<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.accept(Object) line: not available<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(WindowState) line: 779<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(Object) line: 777<br>    WindowState.applyInOrderWithImeWindows(ToBooleanFunction, boolean) line: 4128<br>    WindowState.forAllWindows(ToBooleanFunction, boolean) line: 4035<br>    WallpaperWindowToken(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$NonAppWindowContainers(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent.forAllWindows(ToBooleanFunction, boolean) line: 1534<br>    DisplayContent(WindowContainer).forAllWindows(Consumer, boolean) line: 633<br>    DisplayContent.updateWallpaperForAnimator(WindowAnimator) line: 2628<br>    WindowAnimator.animate(long) line: 202<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameDisplayEventReceiver.run() line: 952<br>    Handler.handleCallback(Message) line: 790<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>Thread [android.anim] (Suspended (breakpoint at line 231 in WindowAnimator))<br>    owns: WindowHashMap  (id=163)<br>    WindowAnimator.animate(long) line: 231<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameDisplayEventReceiver.run() line: 952<br>    Handler.handleCallback(Message) line: 790<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<hr>
<pre><code>case PAUSE_TIMEOUT_MSG: {
    ActivityRecord r = (ActivityRecord)msg.obj;
    // We don&apos;t at this point know if the activity is fullscreen,
    // so we need to be conservative and assume it isn&apos;t.
    Slog.w(TAG, &quot;Activity pause timeout for &quot; + r);
    synchronized (mService) {
        if (r.app != null) {
            mService.logAppTooSlow(r.app, r.pauseTime, &quot;pausing &quot; + r);
        }
        activityPausedLocked(r.appToken, true);
    }
} break;
</code></pre><p>Thread [ActivityManager] (Suspended (breakpoint at line 426 in Choreographer))<br>    owns: WindowHashMap  (id=163)<br>    owns: ActivityManagerService  (id=164)<br>    Choreographer.postCallbackDelayedInternal(int, Object, Object, long) line: 426<br>    Choreographer.postFrameCallbackDelayed(Choreographer$FrameCallback, long) line: 509<br>    Choreographer.postFrameCallback(Choreographer$FrameCallback) line: 489<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStack.activityPausedLocked(IBinder, boolean) line: 1427<br>    ActivityStack$ActivityStackHandler.handleMessage(Message) line: 401<br>    ActivityStack$ActivityStackHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    ServiceThread(HandlerThread).run() line: 65<br>    ServiceThread.run() line: 46    </p>
<hr>
<p>Thread [Binder:14721_8] (Suspended (breakpoint at line 4035 in WindowState))<br>    owns: WindowHashMap  (id=146)<br>    owns: ActivityManagerService  (id=147)<br>    WindowState.forAllWindows(ToBooleanFunction, boolean) line: 4035<br>    WindowToken(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$NonAppWindowContainers(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent.forAllWindows(ToBooleanFunction, boolean) line: 1534<br>    DisplayContent.findFocusedWindow() line: 2267<br>    RootWindowContainer.computeFocusedWindow() line: 170<br>    WindowManagerService.updateFocusedWindowLocked(int, boolean) line: 5993<br>    DisplayContent.layoutAndAssignWindowLayersIfNeeded() line: 2291<br>    StackWindowController.positionChildAtTop(TaskWindowContainerController, boolean) line: 159<br>    ActivityStack.insertTaskAtTop(TaskRecord, ActivityRecord) line: 2844<br>    ActivityStack.moveTaskToFrontLocked(TaskRecord, boolean, ActivityOptions, AppTimeTracker, String) line: 4620<br>    ActivityStarter.setTargetStackAndMoveToFrontIfNeeded(ActivityRecord) line: 1613<br>    ActivityStarter.startActivityUnchecked(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1096<br>    ActivityStarter.startActivity(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1000<br>    ActivityStarter.startActivity(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord) line: 577<br>    ActivityStarter.startActivityLocked(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord, String) line: 283<br>    ActivityStarter.startActivityMayWait(IApplicationThread, int, String, Intent, String, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, ProfilerInfo, WaitResult, Configuration, Bundle, boolean, int, TaskRecord, String) line: 822<br>    ActivityManagerService.startActivityAsUser(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle, int) line: 4622<br>    ActivityManagerService.startActivity(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle) line: 4609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 121<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>退出APP</p>
<p>Thread [Binder:14721_14] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowManagerService.relayoutWindow(Session, IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 2182<br>    Session.relayout(IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 239<br>    Session(IWindowSession$Stub).onTransact(int, Parcel, Parcel, int) line: 286<br>    Session.onTransact(int, Parcel, Parcel, int) line: 163<br>    Session(Binder).execTransact(int, long, long, int) line: 697    </p>
<hr>
<p>启动APP   1</p>
<p>Thread [Binder:14721_11] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    owns: ActivityManagerService  (id=483)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStarter.startActivity(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1010<br>    ActivityStarter.startActivity(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord) line: 577<br>    ActivityStarter.startActivityLocked(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord, String) line: 283<br>    ActivityStarter.startActivityMayWait(IApplicationThread, int, String, Intent, String, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, ProfilerInfo, WaitResult, Configuration, Bundle, boolean, int, TaskRecord, String) line: 822<br>    ActivityManagerService.startActivityAsUser(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle, int) line: 4622<br>    ActivityManagerService.startActivity(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle) line: 4609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 121<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>第2次 animate</p>
<p>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第3次 animate</p>
<p>Thread [Binder:14721_12] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowManagerService.relayoutWindow(Session, IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 2182<br>    Session.relayout(IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 239<br>    Session(IWindowSession$Stub).onTransact(int, Parcel, Parcel, int) line: 286<br>    Session.onTransact(int, Parcel, Parcel, int) line: 163<br>    Session(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>第4次 animate</p>
<p>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第5次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第6次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第7次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第8次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第9次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第10次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第11次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第12次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第13次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第14次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第15次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 413 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.cancelAnimation() line: 413<br>    WindowAnimator.animate(long) line: 231<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第16次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.lambda$-com_android_server_wm_WindowSurfacePlacer_5337() line: 108<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.$m$12() line: not available<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.run() line: not available<br>    Handler.handleCallback(Message) line: 790<br>    Handler.dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第17次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第18次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 413 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.cancelAnimation() line: 413<br>    WindowAnimator.animate(long) line: 231<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第19次 animate<br>Thread [Binder:14721_13] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowManagerService.relayoutWindow(Session, IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 2182<br>    Session.relayout(IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 239<br>    Session(IWindowSession$Stub).onTransact(int, Parcel, Parcel, int) line: 286<br>    Session.onTransact(int, Parcel, Parcel, int) line: 163<br>    Session(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>第20次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第21次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 413 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.cancelAnimation() line: 413<br>    WindowAnimator.animate(long) line: 231<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第22次 animate<br>Thread [Binder:14721_10] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowManagerService.relayoutWindow(Session, IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 2182<br>    Session.relayout(IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 239<br>    Session(IWindowSession$Stub).onTransact(int, Parcel, Parcel, int) line: 286<br>    Session.onTransact(int, Parcel, Parcel, int) line: 163<br>    Session(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>第23次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第24次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 413 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.cancelAnimation() line: 413<br>    WindowAnimator.animate(long) line: 231<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第25次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.lambda$-com_android_server_wm_WindowSurfacePlacer_5337() line: 108<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.$m$12() line: not available<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.run() line: not available<br>    Handler.handleCallback(Message) line: 790<br>    Handler.dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第26次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第27次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 413 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.cancelAnimation() line: 413<br>    WindowAnimator.animate(long) line: 231<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第28次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowState.setupWindowForRemoveOnExit() line: 1994<br>    WindowState.removeIfPossible(boolean) line: 1968<br>    WindowState.removeIfPossible() line: 1848<br>    WindowManagerService.removeWindow(Session, IWindow) line: 1733<br>    Session.remove(IWindow) line: 222<br>    TaskSnapshotSurface.remove() line: 260<br>    AppWindowContainerController.lambda$-com_android_server_wm_AppWindowContainerController_31045(WindowManagerPolicy$StartingSurface) line: 658<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.$m$5() line: not available<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.run() line: not available<br>    Handler.handleCallback(Message) line: 790<br>    Handler.dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第29次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第30次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第31次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第32次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 413 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.cancelAnimation() line: 413<br>    WindowAnimator.animate(long) line: 231<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第33次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.lambda$-com_android_server_wm_WindowSurfacePlacer_5337() line: 108<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.$m$12() line: not available<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.run() line: not available<br>    Handler.handleCallback(Message) line: 790<br>    Handler.dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第34次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>第35次 animate<br>Thread [android.anim] (Suspended (breakpoint at line 413 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.cancelAnimation() line: 413<br>    WindowAnimator.animate(long) line: 231<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>Thread [android.ui] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=460)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowManagerService.relayoutWindow(Session, IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 2061<br>    Session.relayout(IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 239<br>    ViewRootImpl.relayoutWindow(WindowManager$LayoutParams, int, boolean) line: 6141<br>    ViewRootImpl.performTraversals() line: 1905<br>    ViewRootImpl.doTraversal() line: 1396<br>    ViewRootImpl$TraversalRunnable.run() line: 6773<br>    Choreographer$CallbackRecord.run(long) line: 966<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 713<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    UiThread(HandlerThread).run() line: 65<br>    UiThread(ServiceThread).run() line: 46<br>    UiThread.run() line: 42    </p>
<hr>
<p>Thread [android.anim] (Suspended (breakpoint at line 609 in WindowState))<br>    owns: WindowHashMap  (id=460)<br>    WindowState.<init>(WindowManagerService, Session, IWindow, WindowToken, WindowState, int, int, WindowManager$LayoutParams, int, int, boolean) line: 609<br>    WindowManagerService.addWindow(Session, IWindow, int, WindowManager$LayoutParams, int, int, Rect, Rect, Rect, InputChannel) line: 1396<br>    Session.addToDisplay(IWindow, int, WindowManager$LayoutParams, int, int, Rect, Rect, Rect, InputChannel) line: 202<br>    TaskSnapshotSurface.create(WindowManagerService, AppWindowToken, ActivityManager$TaskSnapshot) line: 199<br>    TaskSnapshotController.createStartingSurface(AppWindowToken, ActivityManager$TaskSnapshot) line: 203<br>    SnapshotStartingData.createStartingSurface(AppWindowToken) line: 39<br>    AppWindowContainerController.lambda$-com_android_server_wm_AppWindowContainerController_4735() line: 145<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.$m$4() line: not available<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.run() line: not available<br>    Handler.handleCallback(Message) line: 790<br>    Handler.dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </init></p>
<hr>
<p>启动APP的调用堆栈, scheduleAddStartingWindow调用mAddStartingWindow</p>
<p>Thread [Binder:14721_16] (Suspended (breakpoint at line 593 in AppWindowContainerController))<br>    owns: WindowHashMap  (id=460)<br>    owns: ActivityManagerService  (id=483)<br>    AppWindowContainerController.scheduleAddStartingWindow() line: 593<br>    AppWindowContainerController.createSnapshot(ActivityManager$TaskSnapshot) line: 603<br>    AppWindowContainerController.addStartingWindow(String, int, CompatibilityInfo, CharSequence, int, int, int, int, IBinder, boolean, boolean, boolean, boolean, boolean, boolean) line: 502<br>    ActivityRecord.showStartingWindow(ActivityRecord, boolean, boolean, boolean) line: 2241<br>    ActivityRecord.showStartingWindow(ActivityRecord, boolean, boolean) line: 2226<br>    ActivityStarter.setTargetStackAndMoveToFrontIfNeeded(ActivityRecord) line: 1657<br>    ActivityStarter.startActivityUnchecked(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1096<br>    ActivityStarter.startActivity(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1000<br>    ActivityStarter.startActivity(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord) line: 577<br>    ActivityStarter.startActivityLocked(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord, String) line: 283<br>    ActivityStarter.startActivityMayWait(IApplicationThread, int, String, Intent, String, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, ProfilerInfo, WaitResult, Configuration, Bundle, boolean, int, TaskRecord, String) line: 822<br>    ActivityManagerService.startActivityAsUser(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle, int) line: 4622<br>    ActivityManagerService.startActivity(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle) line: 4609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 121<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>Thread [android.anim] (Suspended (breakpoint at line 609 in WindowState))<br>    owns: WindowHashMap  (id=460)<br>    WindowState.<init>(WindowManagerService, Session, IWindow, WindowToken, WindowState, int, int, WindowManager$LayoutParams, int, int, boolean) line: 609<br>    WindowManagerService.addWindow(Session, IWindow, int, WindowManager$LayoutParams, int, int, Rect, Rect, Rect, InputChannel) line: 1396<br>    Session.addToDisplay(IWindow, int, WindowManager$LayoutParams, int, int, Rect, Rect, Rect, InputChannel) line: 202<br>    TaskSnapshotSurface.create(WindowManagerService, AppWindowToken, ActivityManager$TaskSnapshot) line: 199<br>    TaskSnapshotController.createStartingSurface(AppWindowToken, ActivityManager$TaskSnapshot) line: 203<br>    SnapshotStartingData.createStartingSurface(AppWindowToken) line: 39<br>    AppWindowContainerController.lambda$-com_android_server_wm_AppWindowContainerController_4735() line: 145<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.$m$4() line: not available<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.run() line: not available<br>    Handler.handleCallback(Message) line: 790<br>    Handler.dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </init></p>
<p>这里释放WindowState</p>
<p>Thread [android.anim] (Suspended (breakpoint at line 1746 in WindowManagerService))<br>    owns: WindowHashMap  (id=460)<br>    WindowManagerService.postWindowRemoveCleanupLocked(WindowState) line: 1746<br>    WindowState.removeImmediately() line: 1842<br>    WindowState.destroySurface(boolean, boolean) line: 2842<br>    AppWindowToken.destroySurfaces(boolean) line: 649<br>    AppWindowToken.destroySurfaces() line: 633<br>    WindowState.onExitAnimationDone() line: 4257<br>    WindowStateAnimator.stepAnimationLocked(long) line: 474<br>    DisplayContent.lambda$-com_android_server_wm_DisplayContent_16102(WindowState) line: 339<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.$m$3(Object) line: not available<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.accept(Object) line: not available<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(WindowState) line: 779<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(Object) line: 777<br>    WindowState.applyInOrderWithImeWindows(ToBooleanFunction, boolean) line: 4128<br>    WindowState.forAllWindows(ToBooleanFunction, boolean) line: 4035<br>    AppWindowToken(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    AppWindowToken.forAllWindowsUnchecked(ToBooleanFunction, boolean) line: 1549<br>    AppWindowToken.forAllWindows(ToBooleanFunction, boolean) line: 1544<br>    Task(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    TaskStack(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$TaskStackContainers(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$TaskStackContainers.forAllWindows(ToBooleanFunction, boolean) line: 3405<br>    DisplayContent.forAllWindows(ToBooleanFunction, boolean) line: 1534<br>    DisplayContent(WindowContainer).forAllWindows(Consumer, boolean) line: 633<br>    DisplayContent.updateWindowsForAnimator(WindowAnimator) line: 2618<br>    WindowAnimator.animate(long) line: 201<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>Thread [android.anim] (Suspended (breakpoint at line 1746 in WindowManagerService))<br>    owns: WindowHashMap  (id=1203)<br>    WindowManagerService.postWindowRemoveCleanupLocked(WindowState) line: 1746<br>    WindowState.removeImmediately() line: 1842<br>    WindowState.destroySurface(boolean, boolean) line: 2842<br>    AppWindowToken.destroySurfaces(boolean) line: 649<br>    AppWindowToken.destroySurfaces() line: 633<br>    WindowState.onExitAnimationDone() line: 4257<br>    WindowStateAnimator.stepAnimationLocked(long) line: 474<br>    DisplayContent.lambda$-com_android_server_wm_DisplayContent_16102(WindowState) line: 339<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.$m$3(Object) line: not available<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.accept(Object) line: not available<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(WindowState) line: 779<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(Object) line: 777<br>    WindowState.applyInOrderWithImeWindows(ToBooleanFunction, boolean) line: 4128<br>    WindowState.forAllWindows(ToBooleanFunction, boolean) line: 4035<br>    AppWindowToken(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    AppWindowToken.forAllWindowsUnchecked(ToBooleanFunction, boolean) line: 1549<br>    AppWindowToken.forAllWindows(ToBooleanFunction, boolean) line: 1544<br>    Task(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    TaskStack(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$TaskStackContainers(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$TaskStackContainers.forAllWindows(ToBooleanFunction, boolean) line: 3405<br>    DisplayContent.forAllWindows(ToBooleanFunction, boolean) line: 1534<br>    DisplayContent(WindowContainer).forAllWindows(Consumer, boolean) line: 633<br>    DisplayContent.updateWindowsForAnimator(WindowAnimator) line: 2618<br>    WindowAnimator.animate(long) line: 201<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<h2 id="Class-Name-Shallow-Heap-Retained-Heap-4"><a href="#Class-Name-Shallow-Heap-Retained-Heap-4" class="headerlink" title="Class Name                                                              | Shallow Heap | Retained Heap"></a>Class Name                                                              | Shallow Heap | Retained Heap</h2><h2 id="mAllAppWinAnimators-com-android-server-wm-AppWindowAnimator-0x14eed5c0-96-288"><a href="#mAllAppWinAnimators-com-android-server-wm-AppWindowAnimator-0x14eed5c0-96-288" class="headerlink" title="mAllAppWinAnimators com.android.server.wm.AppWindowAnimator @ 0x14eed5c0|           96 |           288"></a>mAllAppWinAnimators com.android.server.wm.AppWindowAnimator @ 0x14eed5c0|           96 |           288</h2><h2 id="Class-Name-Shallow-Heap-Retained-Heap-5"><a href="#Class-Name-Shallow-Heap-Retained-Heap-5" class="headerlink" title="Class Name                                                    | Shallow Heap | Retained Heap"></a>Class Name                                                    | Shallow Heap | Retained Heap</h2><h2 id="mAppAnimator-com-android-server-wm-AppWindowToken-0x14eeac40-200-1-272"><a href="#mAppAnimator-com-android-server-wm-AppWindowToken-0x14eeac40-200-1-272" class="headerlink" title="mAppAnimator com.android.server.wm.AppWindowToken @ 0x14eeac40|          200 |         1,272"></a>mAppAnimator com.android.server.wm.AppWindowToken @ 0x14eeac40|          200 |         1,272</h2><p>Thread [android.ui] (Suspended (breakpoint at line 844 in DisplayContent))<br>    owns: WindowHashMap  (id=460)<br>    owns: ViewRootImpl  (id=1036)<br>    owns: Object  (id=538)<br>    DisplayContent.reParentWindowToken(WindowToken) line: 844<br>    WindowToken.onDisplayChanged(DisplayContent) line: 247<br>    WindowToken.<init>(WindowManagerService, IBinder, int, boolean, DisplayContent, boolean) line: 111<br>    WindowManagerService.addWindow(Session, IWindow, int, WindowManager$LayoutParams, int, int, Rect, Rect, Rect, InputChannel) line: 1329<br>    Session.addToDisplay(IWindow, int, WindowManager$LayoutParams, int, int, Rect, Rect, Rect, InputChannel) line: 202<br>    ViewRootImpl.setView(View, WindowManager$LayoutParams, View) line: 730<br>    WindowManagerGlobal.addView(View, ViewGroup$LayoutParams, Display, Window) line: 356<br>    WindowManagerImpl.addView(View, ViewGroup$LayoutParams) line: 94<br>    AppNotRespondingDialog(Dialog).show() line: 330<br>    AppErrors.handleShowAnrUi(Message) line: 1065<br>    ActivityManagerService$UiHandler.handleMessage(Message) line: 1817<br>    ActivityManagerService$UiHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    UiThread(HandlerThread).run() line: 65<br>    UiThread(ServiceThread).run() line: 46<br>    UiThread.run() line: 42    </init></p>
<hr>
<p>这里退出应用</p>
<p>调用cancelAnimation()的条件是:</p>
<pre><code>if (!mAnimating) {
    cancelAnimation();
}
</code></pre><p>Thread [android.anim] (Suspended (breakpoint at line 413 in WindowAnimator))<br>    owns: WindowHashMap  (id=1203)<br>    WindowAnimator.cancelAnimation() line: 413<br>    WindowAnimator.animate(long) line: 231<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>Thread [android.anim] (Suspended (breakpoint at line 435 in WindowAnimator))<br>    owns: WindowHashMap  (id=1203)<br>    WindowAnimator.setAnimating(boolean) line: 435<br>    DisplayContent.lambda$-com_android_server_wm_DisplayContent_18415(WindowState) line: 408<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.$m$4(Object) line: not available<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.accept(Object) line: not available<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(WindowState) line: 779<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(Object) line: 777<br>    WindowState.applyInOrderWithImeWindows(ToBooleanFunction, boolean) line: 4128<br>    WindowState.forAllWindows(ToBooleanFunction, boolean) line: 4035<br>    AppWindowToken(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    AppWindowToken.forAllWindowsUnchecked(ToBooleanFunction, boolean) line: 1549<br>    AppWindowToken.forAllWindows(ToBooleanFunction, boolean) line: 1544<br>    Task(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    TaskStack(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$TaskStackContainers(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$TaskStackContainers.forAllWindows(ToBooleanFunction, boolean) line: 3405<br>    DisplayContent.forAllWindows(ToBooleanFunction, boolean) line: 1534<br>    DisplayContent(WindowContainer).forAllWindows(Consumer, boolean) line: 633<br>    DisplayContent.updateWallpaperForAnimator(WindowAnimator) line: 2628<br>    WindowAnimator.animate(long) line: 202<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=1203)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.lambda$-com_android_server_wm_WindowSurfacePlacer_5337() line: 108<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.$m$12() line: not available<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.run() line: not available<br>    Handler.handleCallback(Message) line: 790<br>    Handler.dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<hr>
<p>调用scheduleAnimation APP DIED</p>
<p>Thread [Binder:14721_1] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=1203)<br>    owns: ActivityManagerService  (id=1204)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityManagerService.handleAppDiedLocked(ProcessRecord, boolean, boolean) line: 5435<br>    ActivityManagerService.appDiedLocked(ProcessRecord, int, IApplicationThread, boolean) line: 5594<br>    ActivityManagerService$AppDeathRecipient.binderDied() line: 1641<br>    BinderProxy.sendDeathNotice(IBinder$DeathRecipient) line: 844    </p>
<p>启动APP</p>
<p>Thread [Binder:14721_15] (Suspended (breakpoint at line 593 in AppWindowContainerController))<br>    owns: WindowHashMap  (id=1203)<br>    owns: ActivityManagerService  (id=1204)<br>    AppWindowContainerController.scheduleAddStartingWindow() line: 593<br>    AppWindowContainerController.createSnapshot(ActivityManager$TaskSnapshot) line: 603<br>    AppWindowContainerController.addStartingWindow(String, int, CompatibilityInfo, CharSequence, int, int, int, int, IBinder, boolean, boolean, boolean, boolean, boolean, boolean) line: 502<br>    ActivityRecord.showStartingWindow(ActivityRecord, boolean, boolean, boolean) line: 2241<br>    ActivityRecord.showStartingWindow(ActivityRecord, boolean, boolean) line: 2226<br>    ActivityStarter.setTargetStackAndMoveToFrontIfNeeded(ActivityRecord) line: 1657<br>    ActivityStarter.startActivityUnchecked(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1096<br>    ActivityStarter.startActivity(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1000<br>    ActivityStarter.startActivity(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord) line: 577<br>    ActivityStarter.startActivityLocked(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord, String) line: 283<br>    ActivityStarter.startActivityMayWait(IApplicationThread, int, String, Intent, String, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, ProfilerInfo, WaitResult, Configuration, Bundle, boolean, int, TaskRecord, String) line: 822<br>    ActivityManagerService.startActivityAsUser(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle, int) line: 4622<br>    ActivityManagerService.startActivity(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle) line: 4609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 121<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>启动APP<br>Thread [Binder:14721_15] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=1203)<br>    owns: ActivityManagerService  (id=1204)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStarter.startActivity(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1010<br>    ActivityStarter.startActivity(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord) line: 577<br>    ActivityStarter.startActivityLocked(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord, String) line: 283<br>    ActivityStarter.startActivityMayWait(IApplicationThread, int, String, Intent, String, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, ProfilerInfo, WaitResult, Configuration, Bundle, boolean, int, TaskRecord, String) line: 822<br>    ActivityManagerService.startActivityAsUser(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle, int) line: 4622<br>    ActivityManagerService.startActivity(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle) line: 4609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 121<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>mAddStartingWindow 新增 WindowState</p>
<p>Thread [Binder:14721_15] (Suspended (breakpoint at line 762 in WindowSurfacePlacer))<br>    owns: WindowHashMap  (id=1203)<br>    owns: ActivityManagerService  (id=1204)<br>    WindowSurfacePlacer.requestTraversal() line: 762<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 203<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStarter.startActivity(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1010<br>    ActivityStarter.startActivity(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord) line: 577<br>    ActivityStarter.startActivityLocked(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord, String) line: 283<br>    ActivityStarter.startActivityMayWait(IApplicationThread, int, String, Intent, String, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, ProfilerInfo, WaitResult, Configuration, Bundle, boolean, int, TaskRecord, String) line: 822<br>    ActivityManagerService.startActivityAsUser(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle, int) line: 4622<br>    ActivityManagerService.startActivity(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle) line: 4609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 121<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>Thread [android.anim] (Suspended (breakpoint at line 762 in WindowSurfacePlacer))<br>    owns: WindowHashMap  (id=1203)<br>    WindowSurfacePlacer.requestTraversal() line: 762<br>    WindowManagerService.finishDrawingWindow(Session, IWindow) line: 2363<br>    Session.finishDrawing(IWindow) line: 275<br>    TaskSnapshotSurface.reportDrawn() line: 402<br>    TaskSnapshotSurface.drawSnapshot() line: 292<br>    TaskSnapshotSurface.create(WindowManagerService, AppWindowToken, ActivityManager$TaskSnapshot) line: 222<br>    TaskSnapshotController.createStartingSurface(AppWindowToken, ActivityManager$TaskSnapshot) line: 203<br>    SnapshotStartingData.createStartingSurface(AppWindowToken) line: 39<br>    AppWindowContainerController.lambda$-com_android_server_wm_AppWindowContainerController_4735() line: 145<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.$m$4() line: not available<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.run() line: not available<br>    Handler.handleCallback(Message) line: 790<br>    Handler.dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>setAnimating 为true 就不会退出</p>
<p>Thread [android.anim] (Suspended (breakpoint at line 435 in WindowAnimator))<br>    owns: WindowHashMap  (id=1203)<br>    WindowAnimator.setAnimating(boolean) line: 435<br>    DisplayContent.lambda$-com_android_server_wm_DisplayContent_18415(WindowState) line: 408<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.$m$4(Object) line: not available<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.accept(Object) line: not available<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(WindowState) line: 779<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(Object) line: 777<br>    WindowState.applyInOrderWithImeWindows(ToBooleanFunction, boolean) line: 4128<br>    WindowState.forAllWindows(ToBooleanFunction, boolean) line: 4035<br>    AppWindowToken(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    AppWindowToken.forAllWindowsUnchecked(ToBooleanFunction, boolean) line: 1549<br>    AppWindowToken.forAllWindows(ToBooleanFunction, boolean) line: 1544<br>    Task(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    TaskStack(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$TaskStackContainers(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$TaskStackContainers.forAllWindows(ToBooleanFunction, boolean) line: 3405<br>    DisplayContent.forAllWindows(ToBooleanFunction, boolean) line: 1534<br>    DisplayContent(WindowContainer).forAllWindows(Consumer, boolean) line: 633<br>    DisplayContent.updateWallpaperForAnimator(WindowAnimator) line: 2628<br>    WindowAnimator.animate(long) line: 202<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65    </p>
<pre><code>if (winAnimator.mAnimating) {
    if (winAnimator.mAnimation != null) {
        if ((flags &amp; FLAG_SHOW_WALLPAPER) != 0
                &amp;&amp; winAnimator.mAnimation.getDetachWallpaper()) {
            mTmpWindow = w;
        }
        final int color = winAnimator.mAnimation.getBackgroundColor();
        if (color != 0) {
            final TaskStack stack = w.getStack();
            if (stack != null) {
                stack.setAnimationBackground(winAnimator, color);
            }
        }
    }
    mTmpWindowAnimator.setAnimating(true);
}
</code></pre><p>Thread [Binder:14721_15] (Suspended (breakpoint at line 762 in WindowSurfacePlacer))<br>    owns: WindowHashMap  (id=1203)<br>    owns: ActivityManagerService  (id=1204)<br>    WindowSurfacePlacer.requestTraversal() line: 762<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 203<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStack.activityPausedLocked(IBinder, boolean) line: 1427<br>    ActivityManagerService.activityPaused(IBinder) line: 7609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 317<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>06-27 17:04:11.047   835  2286 V WindowManager: Starting animation in AppWindowToken{b6799a3 token=Token{d5ffdc3 ActivityRecord{d112627 u0 com.android.launcher3/.Launcher t13}}} @ 23774931 scale=1.0 allDrawn=true animating=false<br>06-27 17:04:11.048   835  2286 V WindowManager: Starting animation in AppWindowToken{fcdff0a token=Token{ad2718b ActivityRecord{51a9a7c u0 com.android.dialer/.app.DialtactsActivity t193}}} @ 23774931 scale=1.0 allDrawn=true animating=false<br>06-27 17:04:11.106   835  2286 I WindowManager:   SURFACE POS (setPositionInTransaction) @ (0.0,9.0): com.android.dialer/com.android.dialer.app.DialtactsActivity<br>06-27 17:04:11.122   835  2286 I WindowManager: &lt;&lt;&lt; CLOSE TRANSACTION animate<br>06-27 17:04:11.596   835  2286 I WindowManager: &gt;&gt;&gt; OPEN TRANSACTION animate<br>06-27 17:04:11.650   835  2286 I WindowManager:   SURFACE POS (setPositionInTransaction) @ (0.0,322.0): com.android.dialer/com.android.dialer.app.DialtactsActivity<br>06-27 17:04:11.661   835  2286 I WindowManager: &lt;&lt;&lt; CLOSE TRANSACTION animate<br>06-27 17:04:11.663   835  2286 I WindowManager: &gt;&gt;&gt; OPEN TRANSACTION animate<br>06-27 17:04:11.714   835  2286 I WindowManager:   SURFACE POS (setPositionInTransaction) @ (0.0,939.0): com.android.dialer/com.android.dialer.app.DialtactsActivity<br>06-27 17:04:11.727   835  2286 I WindowManager: &lt;&lt;&lt; CLOSE TRANSACTION animate<br>06-27 17:04:11.739   835  2286 I WindowManager: &gt;&gt;&gt; OPEN TRANSACTION animate<br>06-27 17:04:11.740   835  2286 V WindowManager: Animation done in AppWindowToken{b6799a3 token=Token{d5ffdc3 ActivityRecord{d112627 u0 com.android.launcher3/.Launcher t13}}}: reportedVisible=false okToDisplay=true okToAnimate=true startingDisplayed=false<br>06-27 17:04:11.775   835  2286 V WindowManager: Animation done in AppWindowToken{fcdff0a token=Token{ad2718b ActivityRecord{51a9a7c u0 com.android.dialer/.app.DialtactsActivity t193}}}: reportedVisible=false okToDisplay=true okToAnimate=true startingDisplayed=false<br>06-27 17:04:11.790   835  2286 V WindowManager: Animation done in WindowStateAnimator{c28623a com.android.launcher3/com.android.launcher3.Launcher}: exiting=false, reportedVisible=true<br>06-27 17:04:11.791   835  2286 V WindowManager: Animation done in WindowStateAnimator{1cf447c com.android.dialer/com.android.dialer.app.DialtactsActivity}: exiting=true, reportedVisible=false<br>06-27 17:04:11.826   835  2286 I WindowManager:   SURFACE POS (setPositionInTransaction) @ (0.0,0.0): com.android.dialer/com.android.dialer.app.DialtactsActivity</p>
<p>void scheduleAnimation()</p>
<ol>
<li>动画启动流程</li>
<li>Winstate为什么没有释放</li>
<li><p>为什么forallwindows会走那么久</p>
<p> void requestTraversal() {</p>
<pre><code>if (!mTraversalScheduled) {
    mTraversalScheduled = true;
    mService.mAnimationHandler.post(mPerformSurfacePlacement); //替换?
}
</code></pre><p> }</p>
</li>
</ol>
<p>启动APP时调用动画:</p>
<p>Thread [Binder:14721_16] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=1203)<br>    owns: ActivityManagerService  (id=1204)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStarter.startActivity(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1010<br>    ActivityStarter.startActivity(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord) line: 577<br>    ActivityStarter.startActivityLocked(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord, String) line: 283<br>    ActivityStarter.startActivityMayWait(IApplicationThread, int, String, Intent, String, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, ProfilerInfo, WaitResult, Configuration, Bundle, boolean, int, TaskRecord, String) line: 822<br>    ActivityManagerService.startActivityAsUser(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle, int) line: 4622<br>    ActivityManagerService.startActivity(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle) line: 4609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 121<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>第一次进入animate 会再次调用 scheduleAnimation() 是否下次还需要走 animate 取决与条件 mAnimationFrameCallbackScheduled<br>mAnimationFrameCallbackScheduled初始话默认是 false</p>
<pre><code>void scheduleAnimation() {
    if (!mAnimationFrameCallbackScheduled) {
        mAnimationFrameCallbackScheduled = true;
        mChoreographer.postFrameCallback(mAnimationFrameCallback);
    }
}
</code></pre><p>取消下一次 animate 即 mChoreographer.removeFrameCallback(mAnimationFrameCallback);<br>    private void cancelAnimation() {<br>        if (mAnimationFrameCallbackScheduled) {<br>            mAnimationFrameCallbackScheduled = false;<br>            mChoreographer.removeFrameCallback(mAnimationFrameCallback);<br>        }<br>    }</p>
<p>但是函数里面有一个判断条件:<br>                if (mService.mDragState != null) {<br>                    mAnimating |= mService.mDragState.stepAnimationLocked(mCurrentTime);<br>                }</p>
<pre><code>if (!mAnimating) {
    cancelAnimation();
}
</code></pre><p>整体的代码如下:<br>    private void animate(long frameTimeNs) {</p>
<pre><code>    synchronized (mService.mWindowMap) {
        if (!mInitialized) {
            return;
        }

        // Schedule next frame already such that back-pressure happens continuously
        scheduleAnimation();                                    //这里先预定下一帧
    }

    // Simulate back-pressure by opening and closing an empty animation transaction. This makes
    // sure that an animation frame is at least presented once on the screen. We do this outside
    // of the regular transaction such that we can avoid holding the window manager lock in case
    // we receive back-pressure from SurfaceFlinger. Since closing an animation transaction
    // without the window manager locks leads to ordering issues (as the transaction will be
    // processed only at the beginning of the next frame which may result in another transaction
    // that was executed later in WM side gets executed first on SF side), we don&apos;t update any
    // Surface properties here such that reordering doesn&apos;t cause issues.
    mService.executeEmptyAnimationTransaction();

    synchronized (mService.mWindowMap) {
        mCurrentTime = frameTimeNs / TimeUtils.NANOS_PER_MS;
        mBulkUpdateParams = SET_ORIENTATION_CHANGE_COMPLETE;
        mAnimating = false;                                    //每次都会设置为false
        mAppWindowAnimating = false;
        if (DEBUG_WINDOW_TRACE) {
            Slog.i(TAG, &quot;!!! animate: entry time=&quot; + mCurrentTime);
        }

        if (SHOW_TRANSACTIONS) Slog.i(TAG, &quot;&gt;&gt;&gt; OPEN TRANSACTION animate&quot;);
        mService.openSurfaceTransaction();
        try {
            final AccessibilityController accessibilityController =
                    mService.mAccessibilityController;
            final int numDisplays = mDisplayContentsAnimators.size();
            for (int i = 0; i &lt; numDisplays; i++) {
                final int displayId = mDisplayContentsAnimators.keyAt(i);
                final DisplayContent dc = mService.mRoot.getDisplayContentOrCreate(displayId);
                dc.stepAppWindowsAnimation(mCurrentTime); //这里也可能会置mAppAnimator.animating = true; //这里设置为true
                DisplayContentsAnimator displayAnimator = mDisplayContentsAnimators.valueAt(i);

                final ScreenRotationAnimation screenRotationAnimation =
                        displayAnimator.mScreenRotationAnimation;
                if (screenRotationAnimation != null &amp;&amp; screenRotationAnimation.isAnimating()) {
                    if (screenRotationAnimation.stepAnimationLocked(mCurrentTime)) {
                        setAnimating(true);
                    } else {
                        mBulkUpdateParams |= SET_UPDATE_ROTATION;
                        screenRotationAnimation.kill();
                        displayAnimator.mScreenRotationAnimation = null;

                        //TODO (multidisplay): Accessibility supported only for the default
                        // display.
                        if (accessibilityController != null &amp;&amp; dc.isDefaultDisplay) {
                            // We just finished rotation animation which means we did not
                            // announce the rotation and waited for it to end, announce now.
                            accessibilityController.onRotationChangedLocked(
                                    mService.getDefaultDisplayContentLocked());
                        }
                    }
                }

                // Update animations of all applications, including those
                // associated with exiting/removed apps
                ++mAnimTransactionSequence;
                dc.updateWindowsForAnimator(this);      // 这里轮寻windows 可能会把 winAnimator.mAnimating 置为 true,这样可以影响下一个函数
                dc.updateWallpaperForAnimator(this);    // 这里有可能会把this.mAnimating 设置为true,mUpdateWallpaperForAnimator
                dc.prepareWindowSurfaces();
            }

            for (int i = 0; i &lt; numDisplays; i++) {
                final int displayId = mDisplayContentsAnimators.keyAt(i);
                final DisplayContent dc = mService.mRoot.getDisplayContentOrCreate(displayId);

                dc.checkAppWindowsReadyToShow();

                final ScreenRotationAnimation screenRotationAnimation =
                        mDisplayContentsAnimators.valueAt(i).mScreenRotationAnimation;
                if (screenRotationAnimation != null) {
                    screenRotationAnimation.updateSurfacesInTransaction();
                }

                orAnimating(dc.animateDimLayers());
                orAnimating(dc.getDockedDividerController().animate(mCurrentTime));
                //TODO (multidisplay): Magnification is supported only for the default display.
                if (accessibilityController != null &amp;&amp; dc.isDefaultDisplay) {
                    accessibilityController.drawMagnifiedRegionBorderIfNeededLocked();
                }
            }

            if (mService.mDragState != null) {
                mAnimating |= mService.mDragState.stepAnimationLocked(mCurrentTime);
            }

            if (!mAnimating) {  //这里不为false 时, 就不会取消cancelAnimation.意味着animate 还需要再跑一次,
                cancelAnimation(); //对应scheduleAnimation(),取消调预定的那一帧
            }

            if (mService.mWatermark != null) {
                mService.mWatermark.drawIfNeeded();
            }
        } catch (RuntimeException e) {
            Slog.wtf(TAG, &quot;Unhandled exception in Window Manager&quot;, e);
        } finally {
            mService.closeSurfaceTransaction();
            if (SHOW_TRANSACTIONS) Slog.i(TAG, &quot;&lt;&lt;&lt; CLOSE TRANSACTION animate&quot;);
        }

        boolean hasPendingLayoutChanges = mService.mRoot.hasPendingLayoutChanges(this);
        boolean doRequest = false;
        if (mBulkUpdateParams != 0) {
            doRequest = mService.mRoot.copyAnimToLayoutParams();
        }

        if (hasPendingLayoutChanges || doRequest) {
            mWindowPlacerLocked.requestTraversal();
        }

        if (mAnimating &amp;&amp; !mLastAnimating) {

            // Usually app transitions but quite a load onto the system already (with all the
            // things happening in app), so pause task snapshot persisting to not increase the
            // load.
            mService.mTaskSnapshotController.setPersisterPaused(true);
            Trace.asyncTraceBegin(Trace.TRACE_TAG_WINDOW_MANAGER, &quot;animating&quot;, 0);
        }
        if (!mAnimating &amp;&amp; mLastAnimating) {
            mWindowPlacerLocked.requestTraversal();
            mService.mTaskSnapshotController.setPersisterPaused(false);
            Trace.asyncTraceEnd(Trace.TRACE_TAG_WINDOW_MANAGER, &quot;animating&quot;, 0);
        }

        mLastAnimating = mAnimating;

        if (mRemoveReplacedWindows) {
            mService.mRoot.removeReplacedWindows();
            mRemoveReplacedWindows = false;
        }

        mService.stopUsingSavedSurfaceLocked();
        mService.destroyPreservedSurfaceLocked();
        mService.mWindowPlacerLocked.destroyPendingSurfaces();

        if (DEBUG_WINDOW_TRACE) {
            Slog.i(TAG, &quot;!!! animate: exit mAnimating=&quot; + mAnimating
                    + &quot; mBulkUpdateParams=&quot; + Integer.toHexString(mBulkUpdateParams)
                    + &quot; mPendingLayoutChanges(DEFAULT_DISPLAY)=&quot;
                    + Integer.toHexString(getPendingLayoutChanges(DEFAULT_DISPLAY)));
        }
    }
}
</code></pre><p>Thread [android.anim] (Suspended (breakpoint at line 435 in WindowAnimator))<br>    owns: WindowHashMap  (id=1203)    </p>
<pre><code>WindowAnimator.setAnimating(boolean) line: 435    
</code></pre><hr>
<pre><code>private final Consumer&lt;WindowState&gt; mUpdateWallpaperForAnimator = w -&gt; { //这是一个回调函数 ,所有的window都会执行这个函数forallwindows
    final WindowStateAnimator winAnimator = w.mWinAnimator;
    if (winAnimator.mSurfaceController == null || !winAnimator.hasSurface()) {
        return;
    }

    final int flags = w.mAttrs.flags;

    // If this window is animating, make a note that we have an animating window and take
    // care of a request to run a detached wallpaper animation.
    if (winAnimator.mAnimating) {
        //这个条件决定是否把mAnimating置为true,如果置为true之后,就不会cancelAnimation(),animate 下一次还会执行
        if (winAnimator.mAnimation != null) {
            if ((flags &amp; FLAG_SHOW_WALLPAPER) != 0
                    &amp;&amp; winAnimator.mAnimation.getDetachWallpaper()) {
                mTmpWindow = w;
            }
            final int color = winAnimator.mAnimation.getBackgroundColor();
            if (color != 0) {
                final TaskStack stack = w.getStack();
                if (stack != null) {
                    stack.setAnimationBackground(winAnimator, color);
                }
            }
        }
        mTmpWindowAnimator.setAnimating(true);
    }
</code></pre><hr>
<pre><code>DisplayContent.lambda$-com_android_server_wm_DisplayContent_18415(WindowState) line: 408    
-$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.$m$4(Object) line: not available    
-$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.accept(Object) line: not available    
WindowContainer$ForAllWindowsConsumerWrapper.apply(WindowState) line: 779    
WindowContainer$ForAllWindowsConsumerWrapper.apply(Object) line: 777    
WindowState.applyInOrderWithImeWindows(ToBooleanFunction, boolean) line: 4128    
WindowState.forAllWindows(ToBooleanFunction, boolean) line: 4035    
AppWindowToken(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616    
AppWindowToken.forAllWindowsUnchecked(ToBooleanFunction, boolean) line: 1549    
AppWindowToken.forAllWindows(ToBooleanFunction, boolean) line: 1544    
Task(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616    
TaskStack(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616    
DisplayContent$TaskStackContainers(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616    
DisplayContent$TaskStackContainers.forAllWindows(ToBooleanFunction, boolean) line: 3405    
DisplayContent.forAllWindows(ToBooleanFunction, boolean) line: 1534    
DisplayContent(WindowContainer).forAllWindows(Consumer, boolean) line: 633    
DisplayContent.updateWallpaperForAnimator(WindowAnimator) line: 2628    
WindowAnimator.animate(long) line: 202
</code></pre><hr>
<pre><code>dc.updateWallpaperForAnimator(this);
</code></pre><hr>
<pre><code>WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105    
-$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available    
-$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available    
Choreographer$CallbackRecord.run(long) line: 964    
Choreographer.doCallbacks(int, long) line: 778    
Choreographer.doFrame(long, int) line: 710    
Choreographer$FrameHandler.handleMessage(Message) line: 881    
Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106    
Looper.loop() line: 164    
AnimationThread(HandlerThread).run() line: 65    
AnimationThread(ServiceThread).run() line: 46    
</code></pre><p>下面的这个调用堆栈,把winAnimator.mAnimating 置为了true</p>
<p>Thread [android.anim] (Suspended (breakpoint at line 423 in WindowStateAnimator))<br>    owns: WindowHashMap  (id=1203)<br>    WindowStateAnimator.stepAnimationLocked(long) line: 423<br>    DisplayContent.lambda$-com_android_server_wm_DisplayContent_16102(WindowState) line: 339<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.$m$3(Object) line: not available<br>    -$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.accept(Object) line: not available<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(WindowState) line: 779<br>    WindowContainer$ForAllWindowsConsumerWrapper.apply(Object) line: 777<br>    WindowState.applyInOrderWithImeWindows(ToBooleanFunction, boolean) line: 4128<br>    WindowState.forAllWindows(ToBooleanFunction, boolean) line: 4035<br>    AppWindowToken(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    AppWindowToken.forAllWindowsUnchecked(ToBooleanFunction, boolean) line: 1549<br>    AppWindowToken.forAllWindows(ToBooleanFunction, boolean) line: 1544<br>    Task(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    TaskStack(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$TaskStackContainers(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616<br>    DisplayContent$TaskStackContainers.forAllWindows(ToBooleanFunction, boolean) line: 3405<br>    DisplayContent.forAllWindows(ToBooleanFunction, boolean) line: 1534<br>    DisplayContent(WindowContainer).forAllWindows(Consumer, boolean) line: 633<br>    DisplayContent.updateWindowsForAnimator(WindowAnimator) line: 2618<br>    WindowAnimator.animate(long) line: 201<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameHandler.handleMessage(Message) line: 881<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>这里<br>Thread [android.anim] (Suspended (breakpoint at line 395 in AppWindowAnimator))<br>    owns: WindowHashMap  (id=1203)<br>    AppWindowAnimator.stepAnimationLocked(long) line: 395    </p>
<pre><code>mAppAnimator.animating = true;这里也会设置为true
@Override
void stepAppWindowsAnimation(long currentTime) {
    mAppAnimator.wasAnimating = mAppAnimator.animating;
    if (mAppAnimator.stepAnimationLocked(currentTime)) {
        mAppAnimator.animating = true; //这里设置为true
        mService.mAnimator.setAnimating(true);
        mService.mAnimator.mAppWindowAnimating = true;
    } else if (mAppAnimator.wasAnimating) {
        // stopped animating, do one more pass through the layout
        setAppLayoutChanges(FINISH_LAYOUT_REDO_WALLPAPER,
                DEBUG_LAYOUT_REPEATS ? &quot;appToken &quot; + this + &quot; done&quot; : null);
        if (DEBUG_ANIM) Slog.v(TAG, &quot;updateWindowsApps...: done animating &quot; + this);
    }
}
AppWindowToken.stepAppWindowsAnimation(long) line: 1523    
Task(WindowContainer).stepAppWindowsAnimation(long) line: 511    
TaskStack(WindowContainer).stepAppWindowsAnimation(long) line: 511    
TaskStack.stepAppWindowsAnimation(long) line: 1628    
DisplayContent$TaskStackContainers(WindowContainer).stepAppWindowsAnimation(long) line: 511    
DisplayContent(WindowContainer).stepAppWindowsAnimation(long) line: 511    
WindowAnimator.animate(long) line: 174    
WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105    
-$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available    
-$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available    
Choreographer$CallbackRecord.run(long) line: 964    
Choreographer.doCallbacks(int, long) line: 778    
Choreographer.doFrame(long, int) line: 710    
Choreographer$FrameHandler.handleMessage(Message) line: 881    
Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106    
Looper.loop() line: 164    
AnimationThread(HandlerThread).run() line: 65    
AnimationThread(ServiceThread).run() line: 46    






Thread [android.anim] (Suspended (breakpoint at line 291 in Animation))    
owns: WindowHashMap  (id=1203)    
AlphaAnimation(Animation).reset() line: 291    
public boolean getTransformation(long currentTime, Transformation outTransformation) {
    if (mStartTime == -1) {
        mStartTime = currentTime;
    }

    final long startOffset = getStartOffset();
    final long duration = mDuration;
    float normalizedTime;
    if (duration != 0) {
        normalizedTime = ((float) (currentTime - (mStartTime + startOffset))) /
                (float) duration;
    } else {
        // time is a step-change with a zero duration
        normalizedTime = currentTime &lt; mStartTime ? 0.0f : 1.0f;
    }

    final boolean expired = normalizedTime &gt;= 1.0f || isCanceled();
    mMore = !expired;

    if (!mFillEnabled) normalizedTime = Math.max(Math.min(normalizedTime, 1.0f), 0.0f);

    if ((normalizedTime &gt;= 0.0f || mFillBefore) &amp;&amp; (normalizedTime &lt;= 1.0f || mFillAfter)) {
        if (!mStarted) {
            fireAnimationStart();
            mStarted = true;
            if (NoImagePreloadHolder.USE_CLOSEGUARD) {
                guard.open(&quot;cancel or detach or getTransformation&quot;);
            }
        }

        if (mFillEnabled) normalizedTime = Math.max(Math.min(normalizedTime, 1.0f), 0.0f);

        if (mCycleFlip) {
            normalizedTime = 1.0f - normalizedTime;
        }

        final float interpolatedTime = mInterpolator.getInterpolation(normalizedTime);
        applyTransformation(interpolatedTime, outTransformation);
    }

    if (expired) {
        if (mRepeatCount == mRepeated || isCanceled()) {
            if (!mEnded) {
                mEnded = true;
                guard.close();
                fireAnimationEnd();
            }
        } else {
            if (mRepeatCount &gt; 0) {
                mRepeated++;
            }

            if (mRepeatMode == REVERSE) {
                mCycleFlip = !mCycleFlip;
            }

            mStartTime = -1;
            mMore = true;

            fireAnimationRepeat();
        }
    }

    if (!mMore &amp;&amp; mOneMoreTime) { //这个mOneMoreTime被置为了 true
        mOneMoreTime = false;
        return true;
    }

    return mMore;
}
AlphaAnimation(Animation).initialize(int, int, int, int) line: 354    
WindowStateAnimator.stepAnimationLocked(long) line: 391    
DisplayContent.lambda$-com_android_server_wm_DisplayContent_16102(WindowState) line: 339    
-$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.$m$3(Object) line: not available    
-$Lambda$YIZfR4m-B8z_tYbP2x4OJ3o7OYE.accept(Object) line: not available    
WindowContainer$ForAllWindowsConsumerWrapper.apply(WindowState) line: 779    
WindowContainer$ForAllWindowsConsumerWrapper.apply(Object) line: 777    
WindowState.applyInOrderWithImeWindows(ToBooleanFunction, boolean) line: 4128    
WindowState.forAllWindows(ToBooleanFunction, boolean) line: 4035    
AppWindowToken(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616    
AppWindowToken.forAllWindowsUnchecked(ToBooleanFunction, boolean) line: 1549    
AppWindowToken.forAllWindows(ToBooleanFunction, boolean) line: 1544    
Task(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616    
TaskStack(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616    
DisplayContent$TaskStackContainers(WindowContainer).forAllWindows(ToBooleanFunction, boolean) line: 616    
DisplayContent$TaskStackContainers.forAllWindows(ToBooleanFunction, boolean) line: 3405    
DisplayContent.forAllWindows(ToBooleanFunction, boolean) line: 1534    
DisplayContent(WindowContainer).forAllWindows(Consumer, boolean) line: 633    
DisplayContent.updateWindowsForAnimator(WindowAnimator) line: 2618    
WindowAnimator.animate(long) line: 201    
WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105    
-$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available    
-$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available    
Choreographer$CallbackRecord.run(long) line: 964    
Choreographer.doCallbacks(int, long) line: 778    
Choreographer.doFrame(long, int) line: 710    
Choreographer$FrameHandler.handleMessage(Message) line: 881    
Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 106    
Looper.loop() line: 164    
AnimationThread(HandlerThread).run() line: 65    
AnimationThread(ServiceThread).run() line: 46    
</code></pre><p>Thread [Binder:835_7] (Suspended (breakpoint at line 291 in Animation))<br>    owns: WindowHashMap  (id=11972)<br>    AlphaAnimation(Animation).reset() line: 291<br>    AlphaAnimation(Animation).initialize(int, int, int, int) line: 354<br>    AppWindowAnimator.setAnimation(Animation, int, int, int, int, boolean, int, int, int) line: 133<br>    WindowManagerService.applyAnimationLocked(AppWindowToken, WindowManager$LayoutParams, int, boolean, boolean) line: 2427<br>    AppWindowToken.setVisibility(WindowManager$LayoutParams, boolean, int, boolean, boolean) line: 372<br>    WindowSurfacePlacer.handleClosingApps(int, WindowManager$LayoutParams, boolean, WindowSurfacePlacer$LayerAndToken) line: 461<br>    WindowSurfacePlacer.handleAppTransitionReadyLocked() line: 344<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 615<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowManagerService.relayoutWindow(Session, IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 2182<br>    Session.relayout(IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 239<br>    Session(IWindowSession$Stub).onTransact(int, Parcel, Parcel, int) line: 286<br>    Session.onTransact(int, Parcel, Parcel, int) line: 163<br>    Session(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>mLocalAnimating</p>
<pre><code>if ((!mLocalAnimating || mAnimationIsEntrance) &amp;&amp; mAppAnimator != null
        &amp;&amp; mAppAnimator.animation != null) {
    // When our app token is animating, we kind-of pretend like
    // we are as well.  Note the mLocalAnimating mAnimationIsEntrance
    // part of this check means that we will only do this if
    // our window is not currently exiting, or it is not
    // locally animating itself.  The idea being that one that
    // is exiting and doing a local animation should be removed
    // once that animation is done.
    mAnimating = true; //一直把mAnimating置为true
    mHasTransformation = true;
    mTransformation.clear();
    return false;
}



if (mWin.isDrawnLw() &amp;&amp; mAnimation != null) {  //这个判断的关键点是mAnimation
    mHasTransformation = true;
    mHasLocalTransformation = true;
    if (!mLocalAnimating) {
        if (DEBUG_ANIM) Slog.v(
            TAG, &quot;Starting animation in &quot; + this +
            &quot; @ &quot; + currentTime + &quot;: ww=&quot; + mWin.mFrame.width() +
            &quot; wh=&quot; + mWin.mFrame.height() +
            &quot; dx=&quot; + mAnimDx + &quot; dy=&quot; + mAnimDy +
            &quot; scale=&quot; + mService.getWindowAnimationScaleLocked());
        final DisplayInfo displayInfo = displayContent.getDisplayInfo();
        if (mAnimateMove) {
            mAnimateMove = false;
            mAnimation.initialize(mWin.mFrame.width(), mWin.mFrame.height(),
                    mAnimDx, mAnimDy);
        } else {
            mAnimation.initialize(mWin.mFrame.width(), mWin.mFrame.height(),
                    displayInfo.appWidth, displayInfo.appHeight);
        }
        mAnimDx = displayInfo.appWidth;
        mAnimDy = displayInfo.appHeight;
        mAnimation.setStartTime(mAnimationStartTime != -1
                ? mAnimationStartTime
                : currentTime);
        mLocalAnimating = true; //这里会设置为true
        mAnimating = true;
    }
</code></pre><p>Thread [android.anim] (Suspended (breakpoint at line 271 in WindowStateAnimator))<br>    owns: WindowHashMap  (id=11972)<br>    WindowStateAnimator.setAnimation(Animation, long, int) line: 271<br>    public void setAnimation(Animation anim, long startTime, int stackClip) {<br>        if (localLOGV) Slog.v(TAG, “Setting animation in “ + this + “: “ + anim);<br>        mAnimating = false;<br>        mLocalAnimating = false; //这里会置为false<br>        mAnimation = anim;  //并且赋值mAnimation<br>        mAnimation.restrictDuration(WindowManagerService.MAX_ANIMATION_DURATION);<br>        mAnimation.scaleCurrentDuration(mService.getWindowAnimationScaleLocked());<br>        // Start out animation gone if window is gone, or visible if window is visible.<br>        mTransformation.clear();<br>        mTransformation.setAlpha(mLastHidden ? 0 : 1);<br>        mHasLocalTransformation = true;<br>        mAnimationStartTime = startTime;<br>        mStackClip = stackClip;<br>    }<br>    WindowStateAnimator.setAnimation(Animation) line: 287<br>    WindowStateAnimator.applyAnimationLocked(int, boolean) line: 1858<br>    WindowState.removeIfPossible(boolean) line: 1946<br>    WindowState.removeIfPossible() line: 1848<br>    WindowManagerService.removeWindow(Session, IWindow) line: 1733<br>    Session.remove(IWindow) line: 222<br>    TaskSnapshotSurface.remove() line: 260<br>    AppWindowContainerController.lambda$-com_android_server_wm_AppWindowContainerController_31045(WindowManagerPolicy$StartingSurface) line: 658<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.$m$5() line: not available<br>    -$Lambda$aEpJ2RCAIjecjyIIYTv6ricEwh4.run() line: not available<br>    Handler.handleCallback(Message) line: 790<br>    Handler.dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>Thread [Binder:835_1E] (Suspended (breakpoint at line 291 in Animation))<br>    owns: WindowHashMap  (id=11972)<br>    owns: ActivityManagerService  (id=12078)<br>    AnimationSet(Animation).reset() line: 291<br>    AnimationSet.reset() line: 488<br>    AnimationSet(Animation).initialize(int, int, int, int) line: 354<br>    AnimationSet.initialize(int, int, int, int) line: 425<br>    AppTransition.createClipRevealAnimationLocked(int, boolean, Rect, Rect) line: 867<br>    AppTransition.loadAnimation(WindowManager$LayoutParams, int, boolean, int, int, Rect, Rect, Rect, Rect, Rect, boolean, boolean, int) line: 1563<br>    WindowManagerService.applyAnimationLocked(AppWindowToken, WindowManager$LayoutParams, int, boolean, boolean) line: 2420<br>    AppWindowToken.setVisibility(WindowManager$LayoutParams, boolean, int, boolean, boolean) line: 372<br>    WindowSurfacePlacer.handleOpeningApps(int, WindowManager$LayoutParams, boolean, int) line: 404<br>    WindowSurfacePlacer.handleAppTransitionReadyLocked() line: 348<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 615<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStack.activityPausedLocked(IBinder, boolean) line: 1427<br>    ActivityManagerService.activityPaused(IBinder) line: 7609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 317<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>//其他进程调用 activityStopped<br>Thread [Binder:835_19] (Suspended (breakpoint at line 615 in AppWindowContainerController))<br>    owns: WindowHashMap  (id=11972)<br>    owns: ActivityManagerService  (id=12078)<br>    AppWindowContainerController.removeStartingWindow() line: 615<br>    AppWindowToken.notifyAppStopped() line: 682<br>    AppWindowContainerController.notifyAppStopped() line: 699<br>    ActivityRecord.activityStoppedLocked(Bundle, PersistableBundle, CharSequence) line: 1820<br>    ActivityManagerService.activityStopped(IBinder, Bundle, PersistableBundle, CharSequence) line: 7630<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 347<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>home键</p>
<p>Thread [InputDispatcher] (Suspended (breakpoint at line 615 in AppWindowContainerController))<br>    owns: ActivityManagerService  (id=12078)<br>    AppWindowContainerController.removeStartingWindow() line: 615<br>    ActivityRecord.removeOrphanedStartingWindow(boolean) line: 2256<br>    ActivityStack.cancelInitializingActivities() line: 2236<br>    ActivityStackSupervisor.cancelInitializingActivities() line: 1112<br>    ActivityStack.resumeTopActivityInnerLocked(ActivityRecord, ActivityOptions) line: 2316<br>    ActivityStack.resumeTopActivityUncheckedLocked(ActivityRecord, ActivityOptions) line: 2267<br>    ActivityStackSupervisor.resumeFocusedStackTopActivityLocked(ActivityStack, ActivityRecord, ActivityOptions) line: 2107<br>    ActivityStackSupervisor.resumeFocusedStackTopActivityLocked() line: 2091<br>    ActivityStack.moveTaskToFrontLocked(TaskRecord, boolean, ActivityOptions, AppTimeTracker, String) line: 4652<br>    ActivityStarter.setTargetStackAndMoveToFrontIfNeeded(ActivityRecord) line: 1613<br>    ActivityStarter.startActivityUnchecked(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1096<br>    ActivityStarter.startActivity(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1000<br>    ActivityStarter.startActivity(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord) line: 577<br>    ActivityStarter.startActivityLocked(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord, String) line: 283<br>    ActivityStarter.startActivityMayWait(IApplicationThread, int, String, Intent, String, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, ProfilerInfo, WaitResult, Configuration, Bundle, boolean, int, TaskRecord, String) line: 822<br>    ActivityManagerService.startActivityAsUser(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle, int) line: 4622<br>    ContextImpl.startActivityAsUser(Intent, Bundle, UserHandle) line: 887<br>    ContextImpl.startActivityAsUser(Intent, UserHandle) line: 861<br>    PhoneWindowManager.startActivityAsUser(Intent, UserHandle) line: 4157<br>    PhoneWindowManager.startDockOrHome(boolean, boolean) line: 7833<br>    PhoneWindowManager.launchHomeFromHotKey(boolean, boolean) line: 4281<br>    PhoneWindowManager.launchHomeFromHotKey() line: 4233<br>    PhoneWindowManager.handleShortPressOnHome() line: 1769<br>    PhoneWindowManager.interceptKeyBeforeDispatching(WindowManagerPolicy$WindowState, KeyEvent, int) line: 3499<br>    InputMonitor.interceptKeyBeforeDispatching(InputWindowHandle, KeyEvent, int) line: 466<br>    InputManagerService.interceptKeyBeforeDispatching(InputWindowHandle, KeyEvent, int) line: 1983    </p>
<p>Thread [Binder:835_1E] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=11972)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowManagerService.relayoutWindow(Session, IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 2182<br>    Session.relayout(IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 239<br>    Session(IWindowSession$Stub).onTransact(int, Parcel, Parcel, int) line: 286<br>    Session.onTransact(int, Parcel, Parcel, int) line: 163<br>    Session(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>Thread [android.anim] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=11972)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowAnimator.animate(long) line: 143<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameDisplayEventReceiver.run() line: 952<br>    Handler.handleCallback(Message) line: 790<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>堵在这里回不去</p>
<pre><code>public boolean containsShowWhenLockedWindow(IBinder token) {
    synchronized (mWindowMap) {
        final AppWindowToken wtoken = mRoot.getAppWindowToken(token);
        return wtoken != null &amp;&amp; wtoken.containsShowWhenLockedWindow();
    }
}
</code></pre><p>Thread [Binder:835_1F] (Suspended)<br>    owns: ActivityManagerService  (id=12078)<br>    waiting for: WindowHashMap  (id=11972)<br>    WindowManagerService.containsShowWhenLockedWindow(IBinder) line: 2975<br>    ActivityRecord.canShowWhenLocked() line: 2881<br>    ActivityStack.checkKeyguardVisibility(ActivityRecord, boolean, boolean) line: 1999<br>    ActivityStack.ensureActivitiesVisibleLocked(ActivityRecord, int, boolean) line: 1862<br>    ActivityStackSupervisor.ensureActivitiesVisibleLocked(ActivityRecord, int, boolean) line: 3430<br>    ActivityStack.completePauseLocked(boolean, ActivityRecord) line: 1543<br>    ActivityStack.activityPausedLocked(IBinder, boolean) line: 1425<br>    ActivityManagerService.activityPaused(IBinder) line: 7609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 317<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>现在怀疑是android.anim线程一直占着锁,然后,其他进程的activityPausedLocked线程退不出去</p>
<p>Thread [Binder:835_1E] (Suspended (breakpoint at line 291 in Animation))<br>    owns: WindowHashMap  (id=11972)<br>    owns: ActivityManagerService  (id=12078)<br>    AnimationSet(Animation).reset() line: 291    //reset 是这里走的 可以置条件<br>    AnimationSet.reset() line: 488<br>    AnimationSet(Animation).initialize(int, int, int, int) line: 354<br>    AnimationSet.initialize(int, int, int, int) line: 425<br>    AppTransition.createClipRevealAnimationLocked(int, boolean, Rect, Rect) line: 867<br>    AppTransition.loadAnimation(WindowManager$LayoutParams, int, boolean, int, int, Rect, Rect, Rect, Rect, Rect, boolean, boolean, int) line: 1563<br>    WindowManagerService.applyAnimationLocked(AppWindowToken, WindowManager$LayoutParams, int, boolean, boolean) line: 2420<br>    AppWindowToken.setVisibility(WindowManager$LayoutParams, boolean, int, boolean, boolean) line: 372<br>    WindowSurfacePlacer.handleOpeningApps(int, WindowManager$LayoutParams, boolean, int) line: 404<br>    WindowSurfacePlacer.handleAppTransitionReadyLocked() line: 348<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 615<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStack.activityPausedLocked(IBinder, boolean) line: 1427<br>    ActivityManagerService.activityPaused(IBinder) line: 7609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 317<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>明天可以通过线程的LOG来跟踪</p>
<p>Thread [Binder:835_17] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=11972)<br>    owns: ActivityManagerService  (id=12078)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStarter.startActivity(ActivityRecord, ActivityRecord, IVoiceInteractionSession, IVoiceInteractor, int, boolean, ActivityOptions, TaskRecord, ActivityRecord[]) line: 1010<br>    ActivityStarter.startActivity(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord) line: 577<br>    ActivityStarter.startActivityLocked(IApplicationThread, Intent, Intent, String, ActivityInfo, ResolveInfo, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, int, String, int, int, int, ActivityOptions, boolean, boolean, ActivityRecord[], TaskRecord, String) line: 283<br>    ActivityStarter.startActivityMayWait(IApplicationThread, int, String, Intent, String, IVoiceInteractionSession, IVoiceInteractor, IBinder, String, int, int, ProfilerInfo, WaitResult, Configuration, Bundle, boolean, int, TaskRecord, String) line: 822<br>    ActivityManagerService.startActivityAsUser(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle, int) line: 4622<br>    ActivityManagerService.startActivity(IApplicationThread, String, Intent, String, IBinder, String, int, int, ProfilerInfo, Bundle) line: 4609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 121<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>这里重新调用一下, scheduleAnimation<br>Thread [Binder:835_13] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=11972)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowManagerService.relayoutWindow(Session, IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 2182<br>    Session.relayout(IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 239<br>    Session(IWindowSession$Stub).onTransact(int, Parcel, Parcel, int) line: 286<br>    Session.onTransact(int, Parcel, Parcel, int) line: 163<br>    Session(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>—– pid 13471 at 2018-06-29 09:52:55 —–<br>Cmd line: com.android.dialer<br>Build fingerprint: ‘ATT/QS5509QL/QS5509QL:8.1.0/OPM1.171019.026/v1A6L-0:userdebug/test-keys’<br>ABI: ‘arm’<br>Build type: optimized<br>Zygote loaded classes=5032 post zygote classes=907<br>“main” prio=5 tid=1 Native<br>  | group=”main” sCount=1 dsCount=0 flags=1 obj=0x70bb97f0 self=0xa5ca4000<br>  | sysTid=13471 nice=-10 cgrp=default sched=0/0 handle=0xa9d944a4<br>  | state=S schedstat=( 5295191541 1911600014 4283 ) utm=416 stm=113 core=3 HZ=100<br>  | stack=0xbe3bc000-0xbe3be000 stackSize=8MB<br>  | held mutexes=<br>  native: #00 pc 00049794  /system/lib/libc.so (<strong>ioctl+8)<br>  native: #01 pc 0001e233  /system/lib/libc.so (ioctl+38)<br>  native: #02 pc 0004242f  /system/lib/libbinder.so (android::IPCThreadState::talkWithDriver(bool)+170)<br>  native: #03 pc 00042de9  /system/lib/libbinder.so (android::IPCThreadState::waitForResponse(android::Parcel<em>, int</em>)+236)<br>  native: #04 pc 0003d2e5  /system/lib/libbinder.so (android::BpBinder::transact(unsigned int, android::Parcel const&amp;, android::Parcel*, unsigned int)+36)<br>  native: #05 pc 000bd409  /system/lib/libandroid_runtime.so (???)<br>  native: #06 pc 0064e485  /data/dalvik-cache/arm/system@<a href="mailto:framework@boot.oat" target="_blank" rel="noopener">framework@boot.oat</a> (Java_android_os_BinderProxy_transactNative</strong>ILandroid_os_Parcel_2Landroid_os_Parcel_2I+132)<br>  at android.os.BinderProxy.transactNative(Native method)<br>  at android.os.BinderProxy.transact(Binder.java:764)<br>  at android.view.IWindowSession$Stub$Proxy.relayout(IWindowSession.java:915)<br>  at android.view.ViewRootImpl.relayoutWindow(ViewRootImpl.java:6141)<br>  at android.view.ViewRootImpl.performTraversals(ViewRootImpl.java:1905)<br>  at android.view.ViewRootImpl.doTraversal(ViewRootImpl.java:1396)<br>  at android.view.ViewRootImpl$TraversalRunnable.run(ViewRootImpl.java:6773)<br>  at android.view.Choreographer$CallbackRecord.run(Choreographer.java:966)<br>  at android.view.Choreographer.doCallbacks(Choreographer.java:778)<br>  at android.view.Choreographer.doFrame(Choreographer.java:713)<br>  at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:952)<br>  at android.os.Handler.handleCallback(Handler.java:790)<br>  at android.os.Handler.dispatchMessage(Handler.java:99)<br>  at android.os.Looper.loop(Looper.java:164)<br>  at android.app.ActivityThread.main(ActivityThread.java:6518)<br>  at java.lang.reflect.Method.invoke(Native method)<br>  at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:438)<br>  at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:807)</p>
<p>这里也会block?</p>
<p>Thread [Binder:835_13] (Suspended)<br>    waiting for: ActivityManagerService  (id=12078)<br>    ActivityManagerService.getActivityOptions(IBinder) line: 13588<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 2906<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>“main” prio=5 tid=1 Native<br>  | group=”main” sCount=1 dsCount=0 flags=1 obj=0x70bb97f0 self=0xa5ca4000<br>  | sysTid=13471 nice=-10 cgrp=default sched=0/0 handle=0xa9d944a4<br>  | state=S schedstat=( 5312166227 1913354234 4311 ) utm=416 stm=115 core=1 HZ=100<br>  | stack=0xbe3bc000-0xbe3be000 stackSize=8MB<br>  | held mutexes=<br>  native: #00 pc 00049794  /system/lib/libc.so (<strong>ioctl+8)<br>  native: #01 pc 0001e233  /system/lib/libc.so (ioctl+38)<br>  native: #02 pc 0004242f  /system/lib/libbinder.so (android::IPCThreadState::talkWithDriver(bool)+170)<br>  native: #03 pc 00042de9  /system/lib/libbinder.so (android::IPCThreadState::waitForResponse(android::Parcel<em>, int</em>)+236)<br>  native: #04 pc 0003d2e5  /system/lib/libbinder.so (android::BpBinder::transact(unsigned int, android::Parcel const&amp;, android::Parcel*, unsigned int)+36)<br>  native: #05 pc 000bd409  /system/lib/libandroid_runtime.so (???)<br>  native: #06 pc 0064e485  /data/dalvik-cache/arm/system@<a href="mailto:framework@boot.oat" target="_blank" rel="noopener">framework@boot.oat</a> (Java_android_os_BinderProxy_transactNative</strong>ILandroid_os_Parcel_2Landroid_os_Parcel_2I+132)<br>  at android.os.BinderProxy.transactNative(Native method)<br>  at android.os.BinderProxy.transact(Binder.java:764)<br>  at android.app.IActivityManager$Stub$Proxy.getActivityOptions(IActivityManager.java:8278)<br>  at android.app.Activity.getActivityOptions(Activity.java:6431)<br>  at android.app.Activity.performStart(Activity.java:7044)<br>  at android.app.Activity.performRestart(Activity.java:7123)<br>  at android.app.Activity.performResume(Activity.java:7128)<br>  at android.app.ActivityThread.performResumeActivity(ActivityThread.java:3559)<br>  at android.app.ActivityThread.handleResumeActivity(ActivityThread.java:3624)<br>  at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1641)<br>  at android.os.Handler.dispatchMessage(Handler.java:106)<br>  at android.os.Looper.loop(Looper.java:164)<br>  at android.app.ActivityThread.main(ActivityThread.java:6518)<br>  at java.lang.reflect.Method.invoke(Native method)<br>  at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:438)<br>  at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:807)</p>
<p>超时调用</p>
<p>  Thread [ActivityManager] (Suspended (breakpoint at line 291 in Animation))<br>    owns: WindowHashMap  (id=11972)<br>    owns: ActivityManagerService  (id=12078)<br>    AnimationSet(Animation).reset() line: 291<br>    AnimationSet.reset() line: 488<br>    AnimationSet(Animation).initialize(int, int, int, int) line: 354<br>    AnimationSet.initialize(int, int, int, int) line: 425<br>    AppTransition.createClipRevealAnimationLocked(int, boolean, Rect, Rect) line: 867<br>    AppTransition.loadAnimation(WindowManager$LayoutParams, int, boolean, int, int, Rect, Rect, Rect, Rect, Rect, boolean, boolean, int) line: 1563<br>    WindowManagerService.applyAnimationLocked(AppWindowToken, WindowManager$LayoutParams, int, boolean, boolean) line: 2420<br>    AppWindowToken.setVisibility(WindowManager$LayoutParams, boolean, int, boolean, boolean) line: 372<br>    WindowSurfacePlacer.handleOpeningApps(int, WindowManager$LayoutParams, boolean, int) line: 404<br>    WindowSurfacePlacer.handleAppTransitionReadyLocked() line: 348<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 615<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStack.activityPausedLocked(IBinder, boolean) line: 1427<br>    ActivityStack$ActivityStackHandler.handleMessage(Message) line: 401<br>    ActivityStack$ActivityStackHandler(Handler).dispatchMessage(Message) line: 106<br>    Looper.loop() line: 164<br>    ServiceThread(HandlerThread).run() line: 65<br>    ServiceThread.run() line: 46    </p>
<p>Thread [Binder:835_1B] (Suspended (breakpoint at line 1429 in ActivityStack))<br>    owns: ActivityManagerService  (id=23700)<br>    ActivityStack.activityPausedLocked(IBinder, boolean) line: 1429<br>    ActivityManagerService.activityPaused(IBinder) line: 7609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 317<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>Thread [Binder:835_1B] (Suspended (breakpoint at line 615 in AppWindowContainerController))<br>    owns: WindowHashMap  (id=23648)<br>    owns: ActivityManagerService  (id=23700)<br>    AppWindowContainerController.removeStartingWindow() line: 615<br>    AppWindowToken.notifyAppStopped() line: 682<br>    AppWindowContainerController.notifyAppStopped() line: 699<br>    ActivityRecord.activityStoppedLocked(Bundle, PersistableBundle, CharSequence) line: 1820<br>    ActivityManagerService.activityStopped(IBinder, Bundle, PersistableBundle, CharSequence) line: 7630<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 347<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>APP activityStopped时,才会走removeStartingWindow</p>
<pre><code>public void removeStartingWindow() {
    synchronized (mWindowMap) {//jackywei 这里会有block的问题
        if (mContainer.startingWindow == null) {
            if (mContainer.startingData != null) {
                // Starting window has not been added yet, but it is scheduled to be added.
                // Go ahead and cancel the request.
                if (DEBUG_STARTING_WINDOW) Slog.v(TAG_WM,
                        &quot;Clearing startingData for token=&quot; + mContainer);
                mContainer.startingData = null;
            }
            return;
        }
</code></pre><p>animation = null;</p>
<p>Thread [android.anim] (Suspended (breakpoint at line 179 in AppWindowAnimator))<br>    owns: WindowHashMap  (id=23648)<br>    AppWindowAnimator.setNullAnimation() line: 179<br>    AppWindowAnimator.clearAnimation() line: 188<br>    AppWindowAnimator.stepAnimationLocked(long) line: 413<br>    AppWindowToken.stepAppWindowsAnimation(long) line: 1523<br>    Task(WindowContainer).stepAppWindowsAnimation(long) line: 511<br>    TaskStack(WindowContainer).stepAppWindowsAnimation(long) line: 511<br>    TaskStack.stepAppWindowsAnimation(long) line: 1628<br>    DisplayContent$TaskStackContainers(WindowContainer).stepAppWindowsAnimation(long) line: 511<br>    DisplayContent(WindowContainer).stepAppWindowsAnimation(long) line: 511<br>    WindowAnimator.animate(long) line: 174<br>    WindowAnimator.lambda$-com_android_server_wm_WindowAnimator_3951(long) line: 105<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.$m$0(long) line: not available<br>    -$Lambda$OQfQhd_xsxt9hoLAjIbVfOwa-jY.doFrame(long) line: not available<br>    Choreographer$CallbackRecord.run(long) line: 964<br>    Choreographer.doCallbacks(int, long) line: 778<br>    Choreographer.doFrame(long, int) line: 710<br>    Choreographer$FrameDisplayEventReceiver.run() line: 952<br>    Handler.handleCallback(Message) line: 790<br>    Choreographer$FrameHandler(Handler).dispatchMessage(Message) line: 99<br>    Looper.loop() line: 164<br>    AnimationThread(HandlerThread).run() line: 65<br>    AnimationThread(ServiceThread).run() line: 46    </p>
<p>启动 scheduleAnimation<br>Thread [Binder:835_1A] (Suspended (breakpoint at line 407 in WindowAnimator))<br>    owns: WindowHashMap  (id=23648)<br>    WindowAnimator.scheduleAnimation() line: 407<br>    WindowManagerService.scheduleAnimationLocked() line: 5988<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 824<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowManagerService.relayoutWindow(Session, IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 2182<br>    Session.relayout(IWindow, int, WindowManager$LayoutParams, int, int, int, int, Rect, Rect, Rect, Rect, Rect, Rect, Rect, MergedConfiguration, Surface) line: 239<br>    Session(IWindowSession$Stub).onTransact(int, Parcel, Parcel, int) line: 286<br>    Session.onTransact(int, Parcel, Parcel, int) line: 163<br>    Session(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>把animation = null;//jackywei设置为NULL<br>Thread [Binder:835_1C] (Suspended (breakpoint at line 179 in AppWindowAnimator))<br>    owns: WindowHashMap  (id=23648)<br>    owns: ActivityManagerService  (id=23700)<br>    AppWindowAnimator.setNullAnimation() line: 179<br>    WindowSurfacePlacer.handleClosingApps(int, WindowManager$LayoutParams, boolean, WindowSurfacePlacer$LayerAndToken) line: 458<br>    WindowSurfacePlacer.handleAppTransitionReadyLocked() line: 344<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 615<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStack.activityPausedLocked(IBinder, boolean) line: 1427<br>    ActivityManagerService.activityPaused(IBinder) line: 7609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 317<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>设置animating = false;<br>Thread [Binder:835_1C] (Suspended (breakpoint at line 131 in AppWindowAnimator))<br>    owns: WindowHashMap  (id=23648)<br>    owns: ActivityManagerService  (id=23700)<br>    AppWindowAnimator.setAnimation(Animation, int, int, int, int, boolean, int, int, int) line: 131<br>    WindowManagerService.applyAnimationLocked(AppWindowToken, WindowManager$LayoutParams, int, boolean, boolean) line: 2427<br>    AppWindowToken.setVisibility(WindowManager$LayoutParams, boolean, int, boolean, boolean) line: 372<br>    WindowSurfacePlacer.handleClosingApps(int, WindowManager$LayoutParams, boolean, WindowSurfacePlacer$LayerAndToken) line: 461<br>    WindowSurfacePlacer.handleAppTransitionReadyLocked() line: 344<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 615<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStack.activityPausedLocked(IBinder, boolean) line: 1427<br>    ActivityManagerService.activityPaused(IBinder) line: 7609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 317<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>设置        mMore = true;<br>        mOneMoreTime = true;</p>
<p>Thread [Binder:835_1C] (Suspended (breakpoint at line 291 in Animation))<br>    owns: WindowHashMap  (id=23648)<br>    owns: ActivityManagerService  (id=23700)<br>    AlphaAnimation(Animation).reset() line: 291<br>    AlphaAnimation(Animation).initialize(int, int, int, int) line: 354<br>    AppWindowAnimator.setAnimation(Animation, int, int, int, int, boolean, int, int, int) line: 133<br>    WindowManagerService.applyAnimationLocked(AppWindowToken, WindowManager$LayoutParams, int, boolean, boolean) line: 2427<br>    AppWindowToken.setVisibility(WindowManager$LayoutParams, boolean, int, boolean, boolean) line: 372<br>    WindowSurfacePlacer.handleClosingApps(int, WindowManager$LayoutParams, boolean, WindowSurfacePlacer$LayerAndToken) line: 461<br>    WindowSurfacePlacer.handleAppTransitionReadyLocked() line: 344<br>    RootWindowContainer.performSurfacePlacement(boolean) line: 615<br>    WindowSurfacePlacer.performSurfacePlacementLoop() line: 197<br>    WindowSurfacePlacer.performSurfacePlacement(boolean) line: 145<br>    WindowSurfacePlacer.performSurfacePlacement() line: 135<br>    WindowSurfacePlacer.continueLayout() line: 126<br>    WindowManagerService.continueSurfaceLayout() line: 2966<br>    ActivityStack.activityPausedLocked(IBinder, boolean) line: 1427<br>    ActivityManagerService.activityPaused(IBinder) line: 7609<br>    ActivityManagerService(IActivityManager$Stub).onTransact(int, Parcel, Parcel, int) line: 317<br>    ActivityManagerService.onTransact(int, Parcel, Parcel, int) line: 2977<br>    ActivityManagerService(Binder).execTransact(int, long, long, int) line: 697    </p>
<p>7月7日,<br>问题 again.</p>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>


    
<nav id="article-nav">
    
        <a href="/2018/12/13/bug-jie-xi/chang-shi-jian-shi-yong-zhi-hou-shou-ji-fan-ying-bian-man/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    长时间使用之后手机变慢
                
            </div>
        </a>
    
    
        <a href="/2018/12/13/bug-jie-xi/man-de-wen-ti-2/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">慢的问题2</div>
        </a>
    
</nav>





    
    




<!-- baidu url auto push script -->
<script type="text/javascript">
    !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
</script>     
</section>
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            彪彪 &copy; 2018 
            <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png"></a>
            <br> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme - <a href="https://github.com/zthxxx/hexo-theme-Wikitten">wikitten</a>
            
                <br>
                <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i> <span id="busuanzi_value_site_pv"></span></span>
                &nbsp;|&nbsp;
                <span id="busuanzi_container_site_pv"><i class="fa fa-user"></i> <span id="busuanzi_value_site_uv"></span></span>
            
        </div>
    </div>
    
      <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
      <script>
        if (window.mermaid) {
          mermaid.initialize({theme: 'forest'});
        }
      </script>
    
</footer>

        

    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true,
            TeX: {
                equationNumbers: {
                  autoNumber: 'AMS'
                }
            }
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>